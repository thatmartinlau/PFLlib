==================================================
goal = test
device = cuda
device_id = 0
dataset = MNIST
num_classes = 10
model = CNN
batch_size = 64
local_learning_rate = 0.01
learning_rate_decay = False
learning_rate_decay_gamma = 0.99
global_rounds = 50
top_cnt = 100
local_epochs = 5
algorithm = FedAvg
join_ratio = 0.8
random_join_ratio = False
num_clients = 20
prev = 0
times = 1
eval_gap = 1
save_folder_name = items
auto_break = False
dlg_eval = False
dlg_gap = 100
batch_num_per_client = 2
num_new_clients = 0
fine_tuning_epoch_new = 0
feature_dim = 512
vocab_size = 32000
max_len = 200
client_drop_rate = 0.0
train_slow_rate = 0.0
send_slow_rate = 0.0
time_select = False
time_threthold = 10000
beta = 0.0
lamda = 1.0
mu = 0.0
K = 5
p_learning_rate = 0.01
M = 5
itk = 4000
alphaK = 1.0
sigma = 1.0
alpha = 1.0
plocal_epochs = 1
tau = 1.0
fine_tuning_epochs = 10
dr_learning_rate = 0.0
L = 1.0
noise_dim = 512
generator_learning_rate = 0.005
hidden_dim = 512
server_epochs = 1000
localize_feature_extractor = False
server_learning_rate = 1.0
eta = 1.0
rand_percent = 80
layer_idx = 2
mentee_learning_rate = 0.005
T_start = 0.95
T_end = 0.98
momentum = 0.1
kl_weight = 0.0
prune_interval = 5
prune_amount = 0.5
==================================================

============= Running time: 0th =============
Creating server and clients ...
FedAvgCNN(
  (conv1): Sequential(
    (0): Conv2d(1, 32, kernel_size=(5, 5), stride=(1, 1))
    (1): ReLU(inplace=True)
    (2): MaxPool2d(kernel_size=(2, 2), stride=(2, 2), padding=0, dilation=1, ceil_mode=False)
  )
  (conv2): Sequential(
    (0): Conv2d(32, 64, kernel_size=(5, 5), stride=(1, 1))
    (1): ReLU(inplace=True)
    (2): MaxPool2d(kernel_size=(2, 2), stride=(2, 2), padding=0, dilation=1, ceil_mode=False)
  )
  (fc1): Sequential(
    (0): Linear(in_features=1024, out_features=512, bias=True)
    (1): ReLU(inplace=True)
  )
  (fc): Linear(in_features=512, out_features=10, bias=True)
)

Join ratio / total clients: 0.8 / 20
Finished creating server and clients.

-------------Round number: 0-------------

Evaluate global model
Averaged Train Loss: 2.3125
Averaged Test Accurancy: 0.0583
Averaged Test AUC: 0.4299
Std Test Accurancy: 0.0526
Std Test AUC: 0.1484
------------------------- time cost ------------------------- 6.200376272201538

-------------Round number: 1-------------

Evaluate global model
Averaged Train Loss: 2.1964
Averaged Test Accurancy: 0.4266
Averaged Test AUC: 0.6971
Std Test Accurancy: 0.3055
Std Test AUC: 0.3384
------------------------- time cost ------------------------- 5.41208553314209

-------------Round number: 2-------------

Evaluate global model
Averaged Train Loss: 1.9872
Averaged Test Accurancy: 0.4093
Averaged Test AUC: 0.7208
Std Test Accurancy: 0.3644
Std Test AUC: 0.3016
------------------------- time cost ------------------------- 5.365570783615112

-------------Round number: 3-------------

Evaluate global model
Averaged Train Loss: 1.6150
Averaged Test Accurancy: 0.4868
Averaged Test AUC: 0.8160
Std Test Accurancy: 0.4052
Std Test AUC: 0.1866
------------------------- time cost ------------------------- 6.240306615829468

-------------Round number: 4-------------

Evaluate global model
Averaged Train Loss: 1.2780
Averaged Test Accurancy: 0.6380
Averaged Test AUC: 0.9316
Std Test Accurancy: 0.1718
Std Test AUC: 0.0313
------------------------- time cost ------------------------- 6.028487205505371

-------------Round number: 5-------------

Evaluate global model
Averaged Train Loss: 1.2743
Averaged Test Accurancy: 0.6177
Averaged Test AUC: 0.8895
Std Test Accurancy: 0.3166
Std Test AUC: 0.1336
------------------------- time cost ------------------------- 6.411718130111694

-------------Round number: 6-------------

Evaluate global model
Averaged Train Loss: 1.0065
Averaged Test Accurancy: 0.6972
Averaged Test AUC: 0.9412
Std Test Accurancy: 0.1906
Std Test AUC: 0.0360
------------------------- time cost ------------------------- 5.9282097816467285

-------------Round number: 7-------------

Evaluate global model
Averaged Train Loss: 0.9932
Averaged Test Accurancy: 0.6587
Averaged Test AUC: 0.9331
Std Test Accurancy: 0.2620
Std Test AUC: 0.0504
------------------------- time cost ------------------------- 5.815876483917236

-------------Round number: 8-------------

Evaluate global model
Averaged Train Loss: 0.9348
Averaged Test Accurancy: 0.6955
Averaged Test AUC: 0.9385
Std Test Accurancy: 0.1348
Std Test AUC: 0.0295
------------------------- time cost ------------------------- 5.77475643157959

-------------Round number: 9-------------

Evaluate global model
Averaged Train Loss: 0.8668
Averaged Test Accurancy: 0.7286
Averaged Test AUC: 0.9450
Std Test Accurancy: 0.1477
Std Test AUC: 0.0267
------------------------- time cost ------------------------- 5.914730072021484

-------------Round number: 10-------------

Evaluate global model
Averaged Train Loss: 0.8257
Averaged Test Accurancy: 0.7534
Averaged Test AUC: 0.9454
Std Test Accurancy: 0.1697
Std Test AUC: 0.0459
------------------------- time cost ------------------------- 5.685148000717163

-------------Round number: 11-------------

Evaluate global model
Averaged Train Loss: 0.7994
Averaged Test Accurancy: 0.7233
Averaged Test AUC: 0.9478
Std Test Accurancy: 0.1958
Std Test AUC: 0.0336
------------------------- time cost ------------------------- 5.786676645278931

-------------Round number: 12-------------

Evaluate global model
Averaged Train Loss: 0.8464
Averaged Test Accurancy: 0.7177
Averaged Test AUC: 0.9423
Std Test Accurancy: 0.2399
Std Test AUC: 0.0613
------------------------- time cost ------------------------- 6.227692127227783

-------------Round number: 13-------------

Evaluate global model
Averaged Train Loss: 0.6867
Averaged Test Accurancy: 0.7853
Averaged Test AUC: 0.9532
Std Test Accurancy: 0.1411
Std Test AUC: 0.0326
------------------------- time cost ------------------------- 5.585165977478027

-------------Round number: 14-------------

Evaluate global model
Averaged Train Loss: 0.8114
Averaged Test Accurancy: 0.7427
Averaged Test AUC: 0.9431
Std Test Accurancy: 0.2070
Std Test AUC: 0.0557
------------------------- time cost ------------------------- 5.9117021560668945

-------------Round number: 15-------------

Evaluate global model
Averaged Train Loss: 0.7169
Averaged Test Accurancy: 0.7604
Averaged Test AUC: 0.9482
Std Test Accurancy: 0.2660
Std Test AUC: 0.0633
------------------------- time cost ------------------------- 5.83096170425415

-------------Round number: 16-------------

Evaluate global model
Averaged Train Loss: 0.6744
Averaged Test Accurancy: 0.7712
Averaged Test AUC: 0.9511
Std Test Accurancy: 0.2407
Std Test AUC: 0.0558
------------------------- time cost ------------------------- 5.806002855300903

-------------Round number: 17-------------

Evaluate global model
Averaged Train Loss: 0.6807
Averaged Test Accurancy: 0.7845
Averaged Test AUC: 0.9551
Std Test Accurancy: 0.1761
Std Test AUC: 0.0418
------------------------- time cost ------------------------- 5.985024690628052

-------------Round number: 18-------------

Evaluate global model
Averaged Train Loss: 0.6204
Averaged Test Accurancy: 0.7915
Averaged Test AUC: 0.9582
Std Test Accurancy: 0.1667
Std Test AUC: 0.0328
------------------------- time cost ------------------------- 6.307881116867065

-------------Round number: 19-------------

Evaluate global model
Averaged Train Loss: 0.5488
Averaged Test Accurancy: 0.8306
Averaged Test AUC: 0.9669
Std Test Accurancy: 0.0785
Std Test AUC: 0.0166
------------------------- time cost ------------------------- 5.381666898727417

-------------Round number: 20-------------

Evaluate global model
Averaged Train Loss: 0.7403
Averaged Test Accurancy: 0.7466
Averaged Test AUC: 0.9441
Std Test Accurancy: 0.2878
Std Test AUC: 0.0700
------------------------- time cost ------------------------- 5.83569598197937

-------------Round number: 21-------------

Evaluate global model
Averaged Train Loss: 0.5316
Averaged Test Accurancy: 0.8346
Averaged Test AUC: 0.9673
Std Test Accurancy: 0.0347
Std Test AUC: 0.0084
------------------------- time cost ------------------------- 5.483931541442871

-------------Round number: 22-------------

Evaluate global model
Averaged Train Loss: 0.6406
Averaged Test Accurancy: 0.7712
Averaged Test AUC: 0.9574
Std Test Accurancy: 0.1904
Std Test AUC: 0.0335
------------------------- time cost ------------------------- 6.125548839569092

-------------Round number: 23-------------

Evaluate global model
Averaged Train Loss: 0.5250
Averaged Test Accurancy: 0.8305
Averaged Test AUC: 0.9679
Std Test Accurancy: 0.1102
Std Test AUC: 0.0214
------------------------- time cost ------------------------- 6.478650093078613

-------------Round number: 24-------------

Evaluate global model
Averaged Train Loss: 0.4660
Averaged Test Accurancy: 0.8577
Averaged Test AUC: 0.9713
Std Test Accurancy: 0.0605
Std Test AUC: 0.0152
------------------------- time cost ------------------------- 5.994500398635864

-------------Round number: 25-------------

Evaluate global model
Averaged Train Loss: 0.4719
Averaged Test Accurancy: 0.8519
Averaged Test AUC: 0.9706
Std Test Accurancy: 0.0415
Std Test AUC: 0.0114
------------------------- time cost ------------------------- 5.12122917175293

-------------Round number: 26-------------

Evaluate global model
Averaged Train Loss: 0.5851
Averaged Test Accurancy: 0.7938
Averaged Test AUC: 0.9613
Std Test Accurancy: 0.2066
Std Test AUC: 0.0376
------------------------- time cost ------------------------- 6.617110013961792

-------------Round number: 27-------------

Evaluate global model
Averaged Train Loss: 0.4443
Averaged Test Accurancy: 0.8616
Averaged Test AUC: 0.9723
Std Test Accurancy: 0.0891
Std Test AUC: 0.0196
------------------------- time cost ------------------------- 6.531933784484863

-------------Round number: 28-------------

Evaluate global model
Averaged Train Loss: 0.4238
Averaged Test Accurancy: 0.8693
Averaged Test AUC: 0.9744
Std Test Accurancy: 0.0728
Std Test AUC: 0.0151
------------------------- time cost ------------------------- 5.823945999145508

-------------Round number: 29-------------

Evaluate global model
Averaged Train Loss: 0.4682
Averaged Test Accurancy: 0.8507
Averaged Test AUC: 0.9712
Std Test Accurancy: 0.0776
Std Test AUC: 0.0158
------------------------- time cost ------------------------- 5.860708713531494

-------------Round number: 30-------------

Evaluate global model
Averaged Train Loss: 0.5059
Averaged Test Accurancy: 0.8249
Averaged Test AUC: 0.9665
Std Test Accurancy: 0.2198
Std Test AUC: 0.0425
------------------------- time cost ------------------------- 5.862047433853149

-------------Round number: 31-------------

Evaluate global model
Averaged Train Loss: 0.4112
Averaged Test Accurancy: 0.8730
Averaged Test AUC: 0.9743
Std Test Accurancy: 0.0305
Std Test AUC: 0.0075
------------------------- time cost ------------------------- 6.252312183380127

-------------Round number: 32-------------

Evaluate global model
Averaged Train Loss: 0.4027
Averaged Test Accurancy: 0.8743
Averaged Test AUC: 0.9754
Std Test Accurancy: 0.0585
Std Test AUC: 0.0128
------------------------- time cost ------------------------- 6.361682415008545

-------------Round number: 33-------------

Evaluate global model
Averaged Train Loss: 0.3873
Averaged Test Accurancy: 0.8783
Averaged Test AUC: 0.9763
Std Test Accurancy: 0.0804
Std Test AUC: 0.0156
------------------------- time cost ------------------------- 5.701022148132324

-------------Round number: 34-------------

Evaluate global model
Averaged Train Loss: 0.4735
Averaged Test Accurancy: 0.8425
Averaged Test AUC: 0.9702
Std Test Accurancy: 0.1438
Std Test AUC: 0.0289
------------------------- time cost ------------------------- 5.752402305603027

-------------Round number: 35-------------

Evaluate global model
Averaged Train Loss: 0.4768
Averaged Test Accurancy: 0.8436
Averaged Test AUC: 0.9707
Std Test Accurancy: 0.1278
Std Test AUC: 0.0254
------------------------- time cost ------------------------- 5.877277374267578

-------------Round number: 36-------------

Evaluate global model
Averaged Train Loss: 0.3994
Averaged Test Accurancy: 0.8703
Averaged Test AUC: 0.9751
Std Test Accurancy: 0.0903
Std Test AUC: 0.0166
------------------------- time cost ------------------------- 5.884088754653931

-------------Round number: 37-------------

Evaluate global model
Averaged Train Loss: 0.3776
Averaged Test Accurancy: 0.8824
Averaged Test AUC: 0.9778
Std Test Accurancy: 0.0515
Std Test AUC: 0.0092
------------------------- time cost ------------------------- 6.455288648605347

-------------Round number: 38-------------

Evaluate global model
Averaged Train Loss: 0.3554
Averaged Test Accurancy: 0.8908
Averaged Test AUC: 0.9790
Std Test Accurancy: 0.0676
Std Test AUC: 0.0129
------------------------- time cost ------------------------- 5.692671060562134

-------------Round number: 39-------------

Evaluate global model
Averaged Train Loss: 0.4366
Averaged Test Accurancy: 0.8529
Averaged Test AUC: 0.9740
Std Test Accurancy: 0.1029
Std Test AUC: 0.0174
------------------------- time cost ------------------------- 5.219146013259888

-------------Round number: 40-------------

Evaluate global model
Averaged Train Loss: 0.4514
Averaged Test Accurancy: 0.8502
Averaged Test AUC: 0.9741
Std Test Accurancy: 0.1153
Std Test AUC: 0.0202
------------------------- time cost ------------------------- 6.382739305496216

-------------Round number: 41-------------

Evaluate global model
Averaged Train Loss: 0.3474
Averaged Test Accurancy: 0.8938
Averaged Test AUC: 0.9785
Std Test Accurancy: 0.0666
Std Test AUC: 0.0145
------------------------- time cost ------------------------- 5.709033489227295

-------------Round number: 42-------------

Evaluate global model
Averaged Train Loss: 0.3808
Averaged Test Accurancy: 0.8796
Averaged Test AUC: 0.9770
Std Test Accurancy: 0.0928
Std Test AUC: 0.0179
------------------------- time cost ------------------------- 6.287492513656616

-------------Round number: 43-------------

Evaluate global model
Averaged Train Loss: 0.3221
Averaged Test Accurancy: 0.9016
Averaged Test AUC: 0.9804
Std Test Accurancy: 0.0489
Std Test AUC: 0.0112
------------------------- time cost ------------------------- 5.632132291793823

-------------Round number: 44-------------

Evaluate global model
Averaged Train Loss: 0.4017
Averaged Test Accurancy: 0.8702
Averaged Test AUC: 0.9760
Std Test Accurancy: 0.1071
Std Test AUC: 0.0206
------------------------- time cost ------------------------- 6.351161241531372

-------------Round number: 45-------------

Evaluate global model
Averaged Train Loss: 0.3240
Averaged Test Accurancy: 0.9006
Averaged Test AUC: 0.9798
Std Test Accurancy: 0.0514
Std Test AUC: 0.0116
------------------------- time cost ------------------------- 5.221928834915161

-------------Round number: 46-------------

Evaluate global model
Averaged Train Loss: 0.4410
Averaged Test Accurancy: 0.8522
Averaged Test AUC: 0.9741
Std Test Accurancy: 0.1249
Std Test AUC: 0.0221
------------------------- time cost ------------------------- 5.548824787139893

-------------Round number: 47-------------

Evaluate global model
Averaged Train Loss: 0.3610
Averaged Test Accurancy: 0.8852
Averaged Test AUC: 0.9778
Std Test Accurancy: 0.0913
Std Test AUC: 0.0174
------------------------- time cost ------------------------- 5.521780252456665

-------------Round number: 48-------------

Evaluate global model
Averaged Train Loss: 0.3361
Averaged Test Accurancy: 0.8932
Averaged Test AUC: 0.9797
Std Test Accurancy: 0.0452
Std Test AUC: 0.0085
------------------------- time cost ------------------------- 6.296464443206787

-------------Round number: 49-------------

Evaluate global model
Averaged Train Loss: 0.2991
Averaged Test Accurancy: 0.9102
Averaged Test AUC: 0.9821
Std Test Accurancy: 0.0441
Std Test AUC: 0.0096
------------------------- time cost ------------------------- 6.066237211227417

-------------Round number: 50-------------

Evaluate global model
Averaged Train Loss: 0.3428
Averaged Test Accurancy: 0.8832
Averaged Test AUC: 0.9793
Std Test Accurancy: 0.0916
Std Test AUC: 0.0149
------------------------- time cost ------------------------- 6.146776437759399

Best accuracy.
0.9101502256240361

Average time cost per round.
5.909908537864685
File path: ../results/MNIST_FedAvg_test_0.h5

Average time cost: 302.44s.
Length:  51
std for best accurancy: 0.0
mean for best accurancy: 0.9101502256240361
All done!

Storage on cuda:0
-------------------------------------------------------------------------------
Total Tensors: 36085612 	Used Memory: 93.31M
The allocated memory on cuda:0: 110.06M
Memory differs due to the matrix alignment or invisible gradient buffer tensors
-------------------------------------------------------------------------------

Total time cost: 302.51s.

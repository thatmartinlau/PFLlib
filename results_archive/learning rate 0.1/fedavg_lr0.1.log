==================================================
goal = test
device = cuda
device_id = 0
dataset = MNIST
num_classes = 10
model = CNN
batch_size = 64
local_learning_rate = 0.1
learning_rate_decay = False
learning_rate_decay_gamma = 0.99
global_rounds = 50
top_cnt = 100
local_epochs = 5
algorithm = FedAvg
join_ratio = 0.8
random_join_ratio = False
num_clients = 20
prev = 0
times = 1
eval_gap = 1
save_folder_name = items
auto_break = False
dlg_eval = False
dlg_gap = 100
batch_num_per_client = 2
num_new_clients = 0
fine_tuning_epoch_new = 0
feature_dim = 512
vocab_size = 32000
max_len = 200
client_drop_rate = 0.0
train_slow_rate = 0.0
send_slow_rate = 0.0
time_select = False
time_threthold = 10000
beta = 0.0
lamda = 1.0
mu = 0.0
K = 5
p_learning_rate = 0.01
M = 5
itk = 4000
alphaK = 1.0
sigma = 1.0
alpha = 1.0
plocal_epochs = 1
tau = 1.0
fine_tuning_epochs = 10
dr_learning_rate = 0.0
L = 1.0
noise_dim = 512
generator_learning_rate = 0.005
hidden_dim = 512
server_epochs = 1000
localize_feature_extractor = False
server_learning_rate = 1.0
eta = 1.0
rand_percent = 80
layer_idx = 2
mentee_learning_rate = 0.005
T_start = 0.95
T_end = 0.98
momentum = 0.1
kl_weight = 0.0
prune_interval = 5
prune_amount = 0.5
==================================================

============= Running time: 0th =============
Creating server and clients ...
FedAvgCNN(
  (conv1): Sequential(
    (0): Conv2d(1, 32, kernel_size=(5, 5), stride=(1, 1))
    (1): ReLU(inplace=True)
    (2): MaxPool2d(kernel_size=(2, 2), stride=(2, 2), padding=0, dilation=1, ceil_mode=False)
  )
  (conv2): Sequential(
    (0): Conv2d(32, 64, kernel_size=(5, 5), stride=(1, 1))
    (1): ReLU(inplace=True)
    (2): MaxPool2d(kernel_size=(2, 2), stride=(2, 2), padding=0, dilation=1, ceil_mode=False)
  )
  (fc1): Sequential(
    (0): Linear(in_features=1024, out_features=512, bias=True)
    (1): ReLU(inplace=True)
  )
  (fc): Linear(in_features=512, out_features=10, bias=True)
)

Join ratio / total clients: 0.8 / 20
Finished creating server and clients.

-------------Round number: 0-------------

Evaluate global model
Averaged Train Loss: 2.3125
Averaged Test Accurancy: 0.0583
Averaged Test AUC: 0.4299
Std Test Accurancy: 0.0526
Std Test AUC: 0.1484
------------------------- time cost ------------------------- 5.930591821670532

-------------Round number: 1-------------

Evaluate global model
Averaged Train Loss: 2.1440
Averaged Test Accurancy: 0.3449
Averaged Test AUC: 0.7033
Std Test Accurancy: 0.3481
Std Test AUC: 0.3217
------------------------- time cost ------------------------- 5.93097710609436

-------------Round number: 2-------------

Evaluate global model
Averaged Train Loss: 1.7460
Averaged Test Accurancy: 0.4576
Averaged Test AUC: 0.8228
Std Test Accurancy: 0.3752
Std Test AUC: 0.2141
------------------------- time cost ------------------------- 5.8418426513671875

-------------Round number: 3-------------

Evaluate global model
Averaged Train Loss: 1.2356
Averaged Test Accurancy: 0.6628
Averaged Test AUC: 0.8856
Std Test Accurancy: 0.3513
Std Test AUC: 0.1672
------------------------- time cost ------------------------- 6.052556991577148

-------------Round number: 4-------------

Evaluate global model
Averaged Train Loss: 0.9508
Averaged Test Accurancy: 0.7249
Averaged Test AUC: 0.9323
Std Test Accurancy: 0.3639
Std Test AUC: 0.0932
------------------------- time cost ------------------------- 5.9197633266448975

-------------Round number: 5-------------

Evaluate global model
Averaged Train Loss: 0.9636
Averaged Test Accurancy: 0.6990
Averaged Test AUC: 0.9391
Std Test Accurancy: 0.2694
Std Test AUC: 0.0588
------------------------- time cost ------------------------- 5.712177276611328

-------------Round number: 6-------------

Evaluate global model
Averaged Train Loss: 0.6775
Averaged Test Accurancy: 0.7850
Averaged Test AUC: 0.9672
Std Test Accurancy: 0.1553
Std Test AUC: 0.0243
------------------------- time cost ------------------------- 6.435387134552002

-------------Round number: 7-------------

Evaluate global model
Averaged Train Loss: 0.4524
Averaged Test Accurancy: 0.8846
Averaged Test AUC: 0.9753
Std Test Accurancy: 0.0700
Std Test AUC: 0.0182
------------------------- time cost ------------------------- 6.440837383270264

-------------Round number: 8-------------

Evaluate global model
Averaged Train Loss: 0.3820
Averaged Test Accurancy: 0.8973
Averaged Test AUC: 0.9810
Std Test Accurancy: 0.0543
Std Test AUC: 0.0094
------------------------- time cost ------------------------- 6.245843410491943

-------------Round number: 9-------------

Evaluate global model
Averaged Train Loss: 0.3529
Averaged Test Accurancy: 0.8935
Averaged Test AUC: 0.9801
Std Test Accurancy: 0.1173
Std Test AUC: 0.0186
------------------------- time cost ------------------------- 6.139031410217285

-------------Round number: 10-------------

Evaluate global model
Averaged Train Loss: 0.3957
Averaged Test Accurancy: 0.8729
Averaged Test AUC: 0.9803
Std Test Accurancy: 0.1011
Std Test AUC: 0.0151
------------------------- time cost ------------------------- 5.782262086868286

-------------Round number: 11-------------

Evaluate global model
Averaged Train Loss: 0.2736
Averaged Test Accurancy: 0.9269
Averaged Test AUC: 0.9860
Std Test Accurancy: 0.0517
Std Test AUC: 0.0085
------------------------- time cost ------------------------- 5.779469013214111

-------------Round number: 12-------------

Evaluate global model
Averaged Train Loss: 0.2959
Averaged Test Accurancy: 0.9084
Averaged Test AUC: 0.9833
Std Test Accurancy: 0.0726
Std Test AUC: 0.0140
------------------------- time cost ------------------------- 6.46205472946167

-------------Round number: 13-------------

Evaluate global model
Averaged Train Loss: 0.2923
Averaged Test Accurancy: 0.9005
Averaged Test AUC: 0.9843
Std Test Accurancy: 0.1047
Std Test AUC: 0.0167
------------------------- time cost ------------------------- 5.198393821716309

-------------Round number: 14-------------

Evaluate global model
Averaged Train Loss: 0.5930
Averaged Test Accurancy: 0.7701
Averaged Test AUC: 0.9692
Std Test Accurancy: 0.1853
Std Test AUC: 0.0258
------------------------- time cost ------------------------- 5.9016430377960205

-------------Round number: 15-------------

Evaluate global model
Averaged Train Loss: 0.6253
Averaged Test Accurancy: 0.8269
Averaged Test AUC: 0.9606
Std Test Accurancy: 0.2375
Std Test AUC: 0.0646
------------------------- time cost ------------------------- 6.505542278289795

-------------Round number: 16-------------

Evaluate global model
Averaged Train Loss: 0.2232
Averaged Test Accurancy: 0.9375
Averaged Test AUC: 0.9892
Std Test Accurancy: 0.0403
Std Test AUC: 0.0077
------------------------- time cost ------------------------- 5.856868743896484

-------------Round number: 17-------------

Evaluate global model
Averaged Train Loss: 0.2305
Averaged Test Accurancy: 0.9279
Averaged Test AUC: 0.9868
Std Test Accurancy: 0.0866
Std Test AUC: 0.0148
------------------------- time cost ------------------------- 6.24047589302063

-------------Round number: 18-------------

Evaluate global model
Averaged Train Loss: 0.2241
Averaged Test Accurancy: 0.9229
Averaged Test AUC: 0.9880
Std Test Accurancy: 0.0760
Std Test AUC: 0.0102
------------------------- time cost ------------------------- 6.488747596740723

-------------Round number: 19-------------

Evaluate global model
Averaged Train Loss: 0.2024
Averaged Test Accurancy: 0.9316
Averaged Test AUC: 0.9892
Std Test Accurancy: 0.0787
Std Test AUC: 0.0110
------------------------- time cost ------------------------- 5.106701135635376

-------------Round number: 20-------------

Evaluate global model
Averaged Train Loss: 0.2245
Averaged Test Accurancy: 0.9327
Averaged Test AUC: 0.9866
Std Test Accurancy: 0.0586
Std Test AUC: 0.0125
------------------------- time cost ------------------------- 5.3326568603515625

-------------Round number: 21-------------

Evaluate global model
Averaged Train Loss: 0.2100
Averaged Test Accurancy: 0.9343
Averaged Test AUC: 0.9882
Std Test Accurancy: 0.0506
Std Test AUC: 0.0096
------------------------- time cost ------------------------- 5.665820837020874

-------------Round number: 22-------------

Evaluate global model
Averaged Train Loss: 0.1819
Averaged Test Accurancy: 0.9417
Averaged Test AUC: 0.9899
Std Test Accurancy: 0.0512
Std Test AUC: 0.0095
------------------------- time cost ------------------------- 5.679754257202148

-------------Round number: 23-------------

Evaluate global model
Averaged Train Loss: 0.1914
Averaged Test Accurancy: 0.9343
Averaged Test AUC: 0.9892
Std Test Accurancy: 0.0484
Std Test AUC: 0.0086
------------------------- time cost ------------------------- 6.413013458251953

-------------Round number: 24-------------

Evaluate global model
Averaged Train Loss: 0.1630
Averaged Test Accurancy: 0.9482
Averaged Test AUC: 0.9910
Std Test Accurancy: 0.0523
Std Test AUC: 0.0086
------------------------- time cost ------------------------- 5.952212810516357

-------------Round number: 25-------------

Evaluate global model
Averaged Train Loss: 0.1629
Averaged Test Accurancy: 0.9487
Averaged Test AUC: 0.9908
Std Test Accurancy: 0.0197
Std Test AUC: 0.0037
------------------------- time cost ------------------------- 5.913549423217773

-------------Round number: 26-------------

Evaluate global model
Averaged Train Loss: 0.1955
Averaged Test Accurancy: 0.9347
Averaged Test AUC: 0.9888
Std Test Accurancy: 0.0901
Std Test AUC: 0.0148
------------------------- time cost ------------------------- 6.195301294326782

-------------Round number: 27-------------

Evaluate global model
Averaged Train Loss: 0.3652
Averaged Test Accurancy: 0.8748
Averaged Test AUC: 0.9808
Std Test Accurancy: 0.1805
Std Test AUC: 0.0287
------------------------- time cost ------------------------- 5.3460962772369385

-------------Round number: 28-------------

Evaluate global model
Averaged Train Loss: 0.5876
Averaged Test Accurancy: 0.8289
Averaged Test AUC: 0.9713
Std Test Accurancy: 0.2228
Std Test AUC: 0.0425
------------------------- time cost ------------------------- 5.953988790512085

-------------Round number: 29-------------

Evaluate global model
Averaged Train Loss: 0.1949
Averaged Test Accurancy: 0.9415
Averaged Test AUC: 0.9895
Std Test Accurancy: 0.0552
Std Test AUC: 0.0107
------------------------- time cost ------------------------- 5.4305641651153564

-------------Round number: 30-------------

Evaluate global model
Averaged Train Loss: 0.1779
Averaged Test Accurancy: 0.9433
Averaged Test AUC: 0.9904
Std Test Accurancy: 0.0468
Std Test AUC: 0.0073
------------------------- time cost ------------------------- 6.574517488479614

-------------Round number: 31-------------

Evaluate global model
Averaged Train Loss: 0.1176
Averaged Test Accurancy: 0.9641
Averaged Test AUC: 0.9939
Std Test Accurancy: 0.0180
Std Test AUC: 0.0037
------------------------- time cost ------------------------- 5.8256871700286865

-------------Round number: 32-------------

Evaluate global model
Averaged Train Loss: 0.1272
Averaged Test Accurancy: 0.9592
Averaged Test AUC: 0.9928
Std Test Accurancy: 0.0187
Std Test AUC: 0.0037
------------------------- time cost ------------------------- 5.440889835357666

-------------Round number: 33-------------

Evaluate global model
Averaged Train Loss: 0.1508
Averaged Test Accurancy: 0.9512
Averaged Test AUC: 0.9918
Std Test Accurancy: 0.0437
Std Test AUC: 0.0067
------------------------- time cost ------------------------- 6.330646991729736

-------------Round number: 34-------------

Evaluate global model
Averaged Train Loss: 0.1071
Averaged Test Accurancy: 0.9653
Averaged Test AUC: 0.9943
Std Test Accurancy: 0.0129
Std Test AUC: 0.0030
------------------------- time cost ------------------------- 5.636072635650635

-------------Round number: 35-------------

Evaluate global model
Averaged Train Loss: 0.1396
Averaged Test Accurancy: 0.9542
Averaged Test AUC: 0.9923
Std Test Accurancy: 0.0497
Std Test AUC: 0.0088
------------------------- time cost ------------------------- 5.491981267929077

-------------Round number: 36-------------

Evaluate global model
Averaged Train Loss: 0.1171
Averaged Test Accurancy: 0.9639
Averaged Test AUC: 0.9933
Std Test Accurancy: 0.0197
Std Test AUC: 0.0041
------------------------- time cost ------------------------- 5.569225072860718

-------------Round number: 37-------------

Evaluate global model
Averaged Train Loss: 0.1436
Averaged Test Accurancy: 0.9490
Averaged Test AUC: 0.9918
Std Test Accurancy: 0.0352
Std Test AUC: 0.0060
------------------------- time cost ------------------------- 6.3616979122161865

-------------Round number: 38-------------

Evaluate global model
Averaged Train Loss: 0.1123
Averaged Test Accurancy: 0.9633
Averaged Test AUC: 0.9941
Std Test Accurancy: 0.0331
Std Test AUC: 0.0051
------------------------- time cost ------------------------- 6.300205707550049

-------------Round number: 39-------------

Evaluate global model
Averaged Train Loss: 0.0982
Averaged Test Accurancy: 0.9664
Averaged Test AUC: 0.9944
Std Test Accurancy: 0.0132
Std Test AUC: 0.0033
------------------------- time cost ------------------------- 6.592667579650879

-------------Round number: 40-------------

Evaluate global model
Averaged Train Loss: 0.0945
Averaged Test Accurancy: 0.9684
Averaged Test AUC: 0.9945
Std Test Accurancy: 0.0139
Std Test AUC: 0.0033
------------------------- time cost ------------------------- 5.882415533065796

-------------Round number: 41-------------

Evaluate global model
Averaged Train Loss: 0.1103
Averaged Test Accurancy: 0.9629
Averaged Test AUC: 0.9937
Std Test Accurancy: 0.0208
Std Test AUC: 0.0033
------------------------- time cost ------------------------- 6.002828359603882

-------------Round number: 42-------------

Evaluate global model
Averaged Train Loss: 0.1163
Averaged Test Accurancy: 0.9604
Averaged Test AUC: 0.9932
Std Test Accurancy: 0.0255
Std Test AUC: 0.0042
------------------------- time cost ------------------------- 5.633626937866211

-------------Round number: 43-------------

Evaluate global model
Averaged Train Loss: 0.1419
Averaged Test Accurancy: 0.9518
Averaged Test AUC: 0.9920
Std Test Accurancy: 0.0291
Std Test AUC: 0.0057
------------------------- time cost ------------------------- 6.51366114616394

-------------Round number: 44-------------

Evaluate global model
Averaged Train Loss: 0.1078
Averaged Test Accurancy: 0.9625
Averaged Test AUC: 0.9934
Std Test Accurancy: 0.0205
Std Test AUC: 0.0037
------------------------- time cost ------------------------- 5.96268105506897

-------------Round number: 45-------------

Evaluate global model
Averaged Train Loss: 0.0940
Averaged Test Accurancy: 0.9680
Averaged Test AUC: 0.9946
Std Test Accurancy: 0.0151
Std Test AUC: 0.0032
------------------------- time cost ------------------------- 5.169392108917236

-------------Round number: 46-------------

Evaluate global model
Averaged Train Loss: 0.1165
Averaged Test Accurancy: 0.9608
Averaged Test AUC: 0.9928
Std Test Accurancy: 0.0224
Std Test AUC: 0.0048
------------------------- time cost ------------------------- 6.555152416229248

-------------Round number: 47-------------

Evaluate global model
Averaged Train Loss: 0.1051
Averaged Test Accurancy: 0.9653
Averaged Test AUC: 0.9941
Std Test Accurancy: 0.0340
Std Test AUC: 0.0055
------------------------- time cost ------------------------- 5.811419248580933

-------------Round number: 48-------------

Evaluate global model
Averaged Train Loss: 0.0904
Averaged Test Accurancy: 0.9692
Averaged Test AUC: 0.9946
Std Test Accurancy: 0.0089
Std Test AUC: 0.0029
------------------------- time cost ------------------------- 5.021510124206543

-------------Round number: 49-------------

Evaluate global model
Averaged Train Loss: 0.1292
Averaged Test Accurancy: 0.9542
Averaged Test AUC: 0.9923
Std Test Accurancy: 0.0297
Std Test AUC: 0.0057
------------------------- time cost ------------------------- 5.810384035110474

-------------Round number: 50-------------

Evaluate global model
Averaged Train Loss: 0.1361
Averaged Test Accurancy: 0.9538
Averaged Test AUC: 0.9922
Std Test Accurancy: 0.0580
Std Test AUC: 0.0101
------------------------- time cost ------------------------- 5.69816255569458

Best accuracy.
0.9692123150739704

Average time cost per round.
5.9221671676635745
File path: ../results/MNIST_FedAvg_test_0.h5

Average time cost: 302.77s.
Length:  51
std for best accurancy: 0.0
mean for best accurancy: 0.9692123150739704
All done!

Storage on cuda:0
-------------------------------------------------------------------------------
Total Tensors: 36085612 	Used Memory: 93.31M
The allocated memory on cuda:0: 110.06M
Memory differs due to the matrix alignment or invisible gradient buffer tensors
-------------------------------------------------------------------------------

Total time cost: 302.84s.

==================================================
goal = test
device = cuda
device_id = 0
dataset = MNIST
num_classes = 10
model = CNN
batch_size = 64
local_learning_rate = 0.01
learning_rate_decay = False
learning_rate_decay_gamma = 0.99
global_rounds = 50
top_cnt = 100
local_epochs = 5
algorithm = MOON
join_ratio = 0.8
random_join_ratio = False
num_clients = 100
prev = 0
times = 1
eval_gap = 1
save_folder_name = items
auto_break = False
dlg_eval = False
dlg_gap = 100
batch_num_per_client = 2
num_new_clients = 0
fine_tuning_epoch_new = 0
feature_dim = 512
vocab_size = 32000
max_len = 200
client_drop_rate = 0.0
train_slow_rate = 0.0
send_slow_rate = 0.0
time_select = False
time_threthold = 10000
beta = 0.0
lamda = 1.0
mu = 0.0
K = 5
p_learning_rate = 0.01
M = 5
itk = 4000
alphaK = 1.0
sigma = 1.0
alpha = 1.0
plocal_epochs = 1
tau = 1.0
fine_tuning_epochs = 10
dr_learning_rate = 0.0
L = 1.0
noise_dim = 512
generator_learning_rate = 0.005
hidden_dim = 512
server_epochs = 1000
localize_feature_extractor = False
server_learning_rate = 1.0
eta = 1.0
rand_percent = 80
layer_idx = 2
mentee_learning_rate = 0.005
T_start = 0.95
T_end = 0.98
momentum = 0.1
kl_weight = 0.0
prune_interval = 5
prune_amount = 0.5
==================================================

============= Running time: 0th =============
Creating server and clients ...
FedAvgCNN(
  (conv1): Sequential(
    (0): Conv2d(1, 32, kernel_size=(5, 5), stride=(1, 1))
    (1): ReLU(inplace=True)
    (2): MaxPool2d(kernel_size=(2, 2), stride=(2, 2), padding=0, dilation=1, ceil_mode=False)
  )
  (conv2): Sequential(
    (0): Conv2d(32, 64, kernel_size=(5, 5), stride=(1, 1))
    (1): ReLU(inplace=True)
    (2): MaxPool2d(kernel_size=(2, 2), stride=(2, 2), padding=0, dilation=1, ceil_mode=False)
  )
  (fc1): Sequential(
    (0): Linear(in_features=1024, out_features=512, bias=True)
    (1): ReLU(inplace=True)
  )
  (fc): Linear(in_features=512, out_features=10, bias=True)
)

Join ratio / total clients: 0.8 / 100
Finished creating server and clients.

-------------Round number: 0-------------

Evaluate global model
Averaged Train Loss: 2.3126
Averaged Test Accurancy: 0.0585
Averaged Test AUC: 0.4282
Std Test Accurancy: 0.0714
Std Test AUC: 0.1732
-------------------------------------------------- 11.496022462844849

-------------Round number: 1-------------

Evaluate global model
Averaged Train Loss: 2.2391
Averaged Test Accurancy: 0.2142
Averaged Test AUC: 0.6634
Std Test Accurancy: 0.2338
Std Test AUC: 0.3234
-------------------------------------------------- 12.109723329544067

-------------Round number: 2-------------

Evaluate global model
Averaged Train Loss: 1.9965
Averaged Test Accurancy: 0.5154
Averaged Test AUC: 0.8629
Std Test Accurancy: 0.3250
Std Test AUC: 0.1446
-------------------------------------------------- 12.011991739273071

-------------Round number: 3-------------

Evaluate global model
Averaged Train Loss: 1.7368
Averaged Test Accurancy: 0.5655
Averaged Test AUC: 0.9198
Std Test Accurancy: 0.2654
Std Test AUC: 0.0501
-------------------------------------------------- 11.008297443389893

-------------Round number: 4-------------

Evaluate global model
Averaged Train Loss: 1.5764
Averaged Test Accurancy: 0.5740
Averaged Test AUC: 0.8538
Std Test Accurancy: 0.3232
Std Test AUC: 0.1968
-------------------------------------------------- 9.063554525375366

-------------Round number: 5-------------

Evaluate global model
Averaged Train Loss: 1.5257
Averaged Test Accurancy: 0.4373
Averaged Test AUC: 0.8899
Std Test Accurancy: 0.3669
Std Test AUC: 0.0817
-------------------------------------------------- 10.874076128005981

-------------Round number: 6-------------

Evaluate global model
Averaged Train Loss: 1.2495
Averaged Test Accurancy: 0.6549
Averaged Test AUC: 0.9248
Std Test Accurancy: 0.2311
Std Test AUC: 0.0611
-------------------------------------------------- 12.205948114395142

-------------Round number: 7-------------

Evaluate global model
Averaged Train Loss: 1.0886
Averaged Test Accurancy: 0.7395
Averaged Test AUC: 0.9427
Std Test Accurancy: 0.1207
Std Test AUC: 0.0286
-------------------------------------------------- 12.242447137832642

-------------Round number: 8-------------

Evaluate global model
Averaged Train Loss: 1.0008
Averaged Test Accurancy: 0.7384
Averaged Test AUC: 0.9429
Std Test Accurancy: 0.1453
Std Test AUC: 0.0312
-------------------------------------------------- 12.193484544754028

-------------Round number: 9-------------

Evaluate global model
Averaged Train Loss: 0.9276
Averaged Test Accurancy: 0.7568
Averaged Test AUC: 0.9473
Std Test Accurancy: 0.1114
Std Test AUC: 0.0272
-------------------------------------------------- 10.964073896408081

-------------Round number: 10-------------

Evaluate global model
Averaged Train Loss: 0.9186
Averaged Test Accurancy: 0.7219
Averaged Test AUC: 0.9414
Std Test Accurancy: 0.1668
Std Test AUC: 0.0353
-------------------------------------------------- 12.157348871231079

-------------Round number: 11-------------

Evaluate global model
Averaged Train Loss: 0.8281
Averaged Test Accurancy: 0.7728
Averaged Test AUC: 0.9519
Std Test Accurancy: 0.1004
Std Test AUC: 0.0215
-------------------------------------------------- 11.262670278549194

-------------Round number: 12-------------

Evaluate global model
Averaged Train Loss: 0.8398
Averaged Test Accurancy: 0.7527
Averaged Test AUC: 0.9483
Std Test Accurancy: 0.0834
Std Test AUC: 0.0220
-------------------------------------------------- 11.233083486557007

-------------Round number: 13-------------

Evaluate global model
Averaged Train Loss: 0.8067
Averaged Test Accurancy: 0.7574
Averaged Test AUC: 0.9478
Std Test Accurancy: 0.1547
Std Test AUC: 0.0351
-------------------------------------------------- 12.317625522613525

-------------Round number: 14-------------

Evaluate global model
Averaged Train Loss: 0.7232
Averaged Test Accurancy: 0.7917
Averaged Test AUC: 0.9537
Std Test Accurancy: 0.1006
Std Test AUC: 0.0263
-------------------------------------------------- 11.068870544433594

-------------Round number: 15-------------

Evaluate global model
Averaged Train Loss: 0.7703
Averaged Test Accurancy: 0.7486
Averaged Test AUC: 0.9432
Std Test Accurancy: 0.2423
Std Test AUC: 0.0646
-------------------------------------------------- 12.404054880142212

-------------Round number: 16-------------

Evaluate global model
Averaged Train Loss: 0.6789
Averaged Test Accurancy: 0.8030
Averaged Test AUC: 0.9575
Std Test Accurancy: 0.0948
Std Test AUC: 0.0199
-------------------------------------------------- 11.893434047698975

-------------Round number: 17-------------

Evaluate global model
Averaged Train Loss: 0.6495
Averaged Test Accurancy: 0.8070
Averaged Test AUC: 0.9600
Std Test Accurancy: 0.0914
Std Test AUC: 0.0191
-------------------------------------------------- 10.82709813117981

-------------Round number: 18-------------

Evaluate global model
Averaged Train Loss: 0.7143
Averaged Test Accurancy: 0.7575
Averaged Test AUC: 0.9460
Std Test Accurancy: 0.2384
Std Test AUC: 0.0620
-------------------------------------------------- 11.836442232131958

-------------Round number: 19-------------

Evaluate global model
Averaged Train Loss: 0.6176
Averaged Test Accurancy: 0.8136
Averaged Test AUC: 0.9600
Std Test Accurancy: 0.0908
Std Test AUC: 0.0217
-------------------------------------------------- 10.671533823013306

-------------Round number: 20-------------

Evaluate global model
Averaged Train Loss: 0.6305
Averaged Test Accurancy: 0.7997
Averaged Test AUC: 0.9602
Std Test Accurancy: 0.1044
Std Test AUC: 0.0202
-------------------------------------------------- 10.759427547454834

-------------Round number: 21-------------

Evaluate global model
Averaged Train Loss: 0.6166
Averaged Test Accurancy: 0.8043
Averaged Test AUC: 0.9613
Std Test Accurancy: 0.1058
Std Test AUC: 0.0198
-------------------------------------------------- 10.700251817703247

-------------Round number: 22-------------

Evaluate global model
Averaged Train Loss: 0.6242
Averaged Test Accurancy: 0.8053
Averaged Test AUC: 0.9606
Std Test Accurancy: 0.1232
Std Test AUC: 0.0251
-------------------------------------------------- 10.491127014160156

-------------Round number: 23-------------

Evaluate global model
Averaged Train Loss: 0.6007
Averaged Test Accurancy: 0.8070
Averaged Test AUC: 0.9612
Std Test Accurancy: 0.1105
Std Test AUC: 0.0219
-------------------------------------------------- 10.644070863723755

-------------Round number: 24-------------

Evaluate global model
Averaged Train Loss: 0.5948
Averaged Test Accurancy: 0.8081
Averaged Test AUC: 0.9623
Std Test Accurancy: 0.1145
Std Test AUC: 0.0221
-------------------------------------------------- 10.732280731201172

-------------Round number: 25-------------

Evaluate global model
Averaged Train Loss: 0.5698
Averaged Test Accurancy: 0.8216
Averaged Test AUC: 0.9649
Std Test Accurancy: 0.1111
Std Test AUC: 0.0209
-------------------------------------------------- 11.695391178131104

-------------Round number: 26-------------

Evaluate global model
Averaged Train Loss: 0.5274
Averaged Test Accurancy: 0.8363
Averaged Test AUC: 0.9654
Std Test Accurancy: 0.0882
Std Test AUC: 0.0201
-------------------------------------------------- 8.514362573623657

-------------Round number: 27-------------

Evaluate global model
Averaged Train Loss: 0.6174
Averaged Test Accurancy: 0.7943
Averaged Test AUC: 0.9628
Std Test Accurancy: 0.1170
Std Test AUC: 0.0192
-------------------------------------------------- 10.748531579971313

-------------Round number: 28-------------

Evaluate global model
Averaged Train Loss: 0.5659
Averaged Test Accurancy: 0.8075
Averaged Test AUC: 0.9614
Std Test Accurancy: 0.1526
Std Test AUC: 0.0305
-------------------------------------------------- 8.541093587875366

-------------Round number: 29-------------

Evaluate global model
Averaged Train Loss: 0.7483
Averaged Test Accurancy: 0.7490
Averaged Test AUC: 0.9488
Std Test Accurancy: 0.2422
Std Test AUC: 0.0529
-------------------------------------------------- 10.995013952255249

-------------Round number: 30-------------

Evaluate global model
Averaged Train Loss: 0.5371
Averaged Test Accurancy: 0.8280
Averaged Test AUC: 0.9667
Std Test Accurancy: 0.1060
Std Test AUC: 0.0207
-------------------------------------------------- 9.686269760131836

-------------Round number: 31-------------

Evaluate global model
Averaged Train Loss: 0.6604
Averaged Test Accurancy: 0.7701
Averaged Test AUC: 0.9514
Std Test Accurancy: 0.2525
Std Test AUC: 0.0599
-------------------------------------------------- 11.185590028762817

-------------Round number: 32-------------

Evaluate global model
Averaged Train Loss: 0.5186
Averaged Test Accurancy: 0.8256
Averaged Test AUC: 0.9676
Std Test Accurancy: 0.1295
Std Test AUC: 0.0225
-------------------------------------------------- 11.234038352966309

-------------Round number: 33-------------

Evaluate global model
Averaged Train Loss: 0.5075
Averaged Test Accurancy: 0.8340
Averaged Test AUC: 0.9694
Std Test Accurancy: 0.1225
Std Test AUC: 0.0208
-------------------------------------------------- 11.92515778541565

-------------Round number: 34-------------

Evaluate global model
Averaged Train Loss: 0.4572
Averaged Test Accurancy: 0.8584
Averaged Test AUC: 0.9707
Std Test Accurancy: 0.0769
Std Test AUC: 0.0165
-------------------------------------------------- 10.800084590911865

-------------Round number: 35-------------

Evaluate global model
Averaged Train Loss: 0.4596
Averaged Test Accurancy: 0.8576
Averaged Test AUC: 0.9714
Std Test Accurancy: 0.0616
Std Test AUC: 0.0103
-------------------------------------------------- 10.843037605285645

-------------Round number: 36-------------

Evaluate global model
Averaged Train Loss: 0.5076
Averaged Test Accurancy: 0.8235
Averaged Test AUC: 0.9653
Std Test Accurancy: 0.1940
Std Test AUC: 0.0398
-------------------------------------------------- 9.96467137336731

-------------Round number: 37-------------

Evaluate global model
Averaged Train Loss: 0.5032
Averaged Test Accurancy: 0.8260
Averaged Test AUC: 0.9690
Std Test Accurancy: 0.1229
Std Test AUC: 0.0193
-------------------------------------------------- 9.725833654403687

-------------Round number: 38-------------

Evaluate global model
Averaged Train Loss: 0.5171
Averaged Test Accurancy: 0.8209
Averaged Test AUC: 0.9644
Std Test Accurancy: 0.1811
Std Test AUC: 0.0377
-------------------------------------------------- 9.66557765007019

-------------Round number: 39-------------

Evaluate global model
Averaged Train Loss: 0.5004
Averaged Test Accurancy: 0.8255
Averaged Test AUC: 0.9646
Std Test Accurancy: 0.1807
Std Test AUC: 0.0373
-------------------------------------------------- 11.086310625076294

-------------Round number: 40-------------

Evaluate global model
Averaged Train Loss: 0.4635
Averaged Test Accurancy: 0.8513
Averaged Test AUC: 0.9716
Std Test Accurancy: 0.0986
Std Test AUC: 0.0176
-------------------------------------------------- 10.895866870880127

-------------Round number: 41-------------

Evaluate global model
Averaged Train Loss: 0.4199
Averaged Test Accurancy: 0.8657
Averaged Test AUC: 0.9738
Std Test Accurancy: 0.0836
Std Test AUC: 0.0150
-------------------------------------------------- 9.803833246231079

-------------Round number: 42-------------

Evaluate global model
Averaged Train Loss: 0.4409
Averaged Test Accurancy: 0.8572
Averaged Test AUC: 0.9731
Std Test Accurancy: 0.0709
Std Test AUC: 0.0134
-------------------------------------------------- 10.069601058959961

-------------Round number: 43-------------

Evaluate global model
Averaged Train Loss: 0.4486
Averaged Test Accurancy: 0.8551
Averaged Test AUC: 0.9725
Std Test Accurancy: 0.0957
Std Test AUC: 0.0174
-------------------------------------------------- 10.947996854782104

-------------Round number: 44-------------

Evaluate global model
Averaged Train Loss: 0.3979
Averaged Test Accurancy: 0.8716
Averaged Test AUC: 0.9755
Std Test Accurancy: 0.0830
Std Test AUC: 0.0139
-------------------------------------------------- 11.89269471168518

-------------Round number: 45-------------

Evaluate global model
Averaged Train Loss: 0.3754
Averaged Test Accurancy: 0.8814
Averaged Test AUC: 0.9768
Std Test Accurancy: 0.0734
Std Test AUC: 0.0123
-------------------------------------------------- 10.884892702102661

-------------Round number: 46-------------

Evaluate global model
Averaged Train Loss: 0.4098
Averaged Test Accurancy: 0.8629
Averaged Test AUC: 0.9748
Std Test Accurancy: 0.0958
Std Test AUC: 0.0167
-------------------------------------------------- 11.668622970581055

-------------Round number: 47-------------

Evaluate global model
Averaged Train Loss: 0.3701
Averaged Test Accurancy: 0.8818
Averaged Test AUC: 0.9775
Std Test Accurancy: 0.0735
Std Test AUC: 0.0126
-------------------------------------------------- 10.628597259521484

-------------Round number: 48-------------

Evaluate global model
Averaged Train Loss: 0.4126
Averaged Test Accurancy: 0.8675
Averaged Test AUC: 0.9743
Std Test Accurancy: 0.0967
Std Test AUC: 0.0174
-------------------------------------------------- 9.641364097595215

-------------Round number: 49-------------

Evaluate global model
Averaged Train Loss: 0.4251
Averaged Test Accurancy: 0.8564
Averaged Test AUC: 0.9714
Std Test Accurancy: 0.1423
Std Test AUC: 0.0280
-------------------------------------------------- 10.570767879486084

-------------Round number: 50-------------

Evaluate global model
Averaged Train Loss: 0.4088
Averaged Test Accurancy: 0.8670
Averaged Test AUC: 0.9744
Std Test Accurancy: 0.0994
Std Test AUC: 0.0180
-------------------------------------------------- 10.0569908618927

Best accuracy.
0.8818430656934306

Best local accuracy.

Averaged time per iteration.
10.90690218925476
File path: ../results/MNIST_MOON_test_0.h5

Average time cost: 557.74s.
Length:  51
std for best accurancy: 0.0
mean for best accurancy: 0.8818430656934306
All done!

Storage on cuda:0
-------------------------------------------------------------------------------
Total Tensors: 234556478 	Used Memory: 673.17M
The allocated memory on cuda:0: 690.67M
Memory differs due to the matrix alignment or invisible gradient buffer tensors
-------------------------------------------------------------------------------

Total time cost: 557.83s.

==================================================
goal = test
device = cuda
device_id = 0
dataset = MNIST
num_classes = 10
model = CNN
batch_size = 64
local_learning_rate = 0.01
learning_rate_decay = False
learning_rate_decay_gamma = 0.99
global_rounds = 50
top_cnt = 100
local_epochs = 1
algorithm = FedAvg
join_ratio = 0.8
random_join_ratio = False
num_clients = 20
prev = 0
times = 1
eval_gap = 1
save_folder_name = items
auto_break = False
dlg_eval = False
dlg_gap = 100
batch_num_per_client = 2
num_new_clients = 0
fine_tuning_epoch_new = 0
feature_dim = 512
vocab_size = 32000
max_len = 200
client_drop_rate = 0.0
train_slow_rate = 0.0
send_slow_rate = 0.0
time_select = False
time_threthold = 10000
beta = 0.0
lamda = 1.0
mu = 0.0
K = 5
p_learning_rate = 0.01
M = 5
itk = 4000
alphaK = 1.0
sigma = 1.0
alpha = 1.0
plocal_epochs = 1
tau = 1.0
fine_tuning_epochs = 10
dr_learning_rate = 0.0
L = 1.0
noise_dim = 512
generator_learning_rate = 0.005
hidden_dim = 512
server_epochs = 1000
localize_feature_extractor = False
server_learning_rate = 1.0
eta = 1.0
rand_percent = 80
layer_idx = 2
mentee_learning_rate = 0.005
T_start = 0.95
T_end = 0.98
momentum = 0.1
kl_weight = 0.0
prune_interval = 5
prune_amount = 0.5
==================================================

============= Running time: 0th =============
Creating server and clients ...
FedAvgCNN(
  (conv1): Sequential(
    (0): Conv2d(1, 32, kernel_size=(5, 5), stride=(1, 1))
    (1): ReLU(inplace=True)
    (2): MaxPool2d(kernel_size=(2, 2), stride=(2, 2), padding=0, dilation=1, ceil_mode=False)
  )
  (conv2): Sequential(
    (0): Conv2d(32, 64, kernel_size=(5, 5), stride=(1, 1))
    (1): ReLU(inplace=True)
    (2): MaxPool2d(kernel_size=(2, 2), stride=(2, 2), padding=0, dilation=1, ceil_mode=False)
  )
  (fc1): Sequential(
    (0): Linear(in_features=1024, out_features=512, bias=True)
    (1): ReLU(inplace=True)
  )
  (fc): Linear(in_features=512, out_features=10, bias=True)
)

Join ratio / total clients: 0.8 / 20
Finished creating server and clients.

-------------Round number: 0-------------

Evaluate global model
Averaged Train Loss: 2.3125
Averaged Test Accurancy: 0.0583
Averaged Test AUC: 0.4299
Std Test Accurancy: 0.0526
Std Test AUC: 0.1484
------------------------- time cost ------------------------- 2.7872869968414307

-------------Round number: 1-------------

Evaluate global model
Averaged Train Loss: 2.2633
Averaged Test Accurancy: 0.1432
Averaged Test AUC: 0.6195
Std Test Accurancy: 0.2113
Std Test AUC: 0.3024
------------------------- time cost ------------------------- 2.650423765182495

-------------Round number: 2-------------

Evaluate global model
Averaged Train Loss: 2.1598
Averaged Test Accurancy: 0.3485
Averaged Test AUC: 0.6211
Std Test Accurancy: 0.4238
Std Test AUC: 0.3293
------------------------- time cost ------------------------- 2.7403411865234375

-------------Round number: 3-------------

Evaluate global model
Averaged Train Loss: 1.9056
Averaged Test Accurancy: 0.4987
Averaged Test AUC: 0.8881
Std Test Accurancy: 0.1937
Std Test AUC: 0.0504
------------------------- time cost ------------------------- 2.458144426345825

-------------Round number: 4-------------

Evaluate global model
Averaged Train Loss: 1.7854
Averaged Test Accurancy: 0.4334
Averaged Test AUC: 0.8147
Std Test Accurancy: 0.3584
Std Test AUC: 0.2194
------------------------- time cost ------------------------- 2.3518059253692627

-------------Round number: 5-------------

Evaluate global model
Averaged Train Loss: 1.6517
Averaged Test Accurancy: 0.4114
Averaged Test AUC: 0.8175
Std Test Accurancy: 0.4268
Std Test AUC: 0.1557
------------------------- time cost ------------------------- 2.66937518119812

-------------Round number: 6-------------

Evaluate global model
Averaged Train Loss: 1.4145
Averaged Test Accurancy: 0.6050
Averaged Test AUC: 0.8998
Std Test Accurancy: 0.3285
Std Test AUC: 0.1079
------------------------- time cost ------------------------- 2.426748514175415

-------------Round number: 7-------------

Evaluate global model
Averaged Train Loss: 1.4181
Averaged Test Accurancy: 0.5179
Averaged Test AUC: 0.8836
Std Test Accurancy: 0.4048
Std Test AUC: 0.1108
------------------------- time cost ------------------------- 2.7086918354034424

-------------Round number: 8-------------

Evaluate global model
Averaged Train Loss: 1.2197
Averaged Test Accurancy: 0.6301
Averaged Test AUC: 0.9119
Std Test Accurancy: 0.3007
Std Test AUC: 0.0826
------------------------- time cost ------------------------- 2.3882219791412354

-------------Round number: 9-------------

Evaluate global model
Averaged Train Loss: 1.2540
Averaged Test Accurancy: 0.6062
Averaged Test AUC: 0.9077
Std Test Accurancy: 0.2555
Std Test AUC: 0.0872
------------------------- time cost ------------------------- 2.5489399433135986

-------------Round number: 10-------------

Evaluate global model
Averaged Train Loss: 1.0776
Averaged Test Accurancy: 0.7158
Averaged Test AUC: 0.9393
Std Test Accurancy: 0.0792
Std Test AUC: 0.0189
------------------------- time cost ------------------------- 2.7549567222595215

-------------Round number: 11-------------

Evaluate global model
Averaged Train Loss: 0.9832
Averaged Test Accurancy: 0.7416
Averaged Test AUC: 0.9414
Std Test Accurancy: 0.1343
Std Test AUC: 0.0334
------------------------- time cost ------------------------- 2.4720458984375

-------------Round number: 12-------------

Evaluate global model
Averaged Train Loss: 1.0531
Averaged Test Accurancy: 0.6281
Averaged Test AUC: 0.9268
Std Test Accurancy: 0.2862
Std Test AUC: 0.0536
------------------------- time cost ------------------------- 2.523045539855957

-------------Round number: 13-------------

Evaluate global model
Averaged Train Loss: 1.1284
Averaged Test Accurancy: 0.6352
Averaged Test AUC: 0.9051
Std Test Accurancy: 0.2982
Std Test AUC: 0.1098
------------------------- time cost ------------------------- 2.431776762008667

-------------Round number: 14-------------

Evaluate global model
Averaged Train Loss: 0.9825
Averaged Test Accurancy: 0.6745
Averaged Test AUC: 0.9214
Std Test Accurancy: 0.3027
Std Test AUC: 0.0850
------------------------- time cost ------------------------- 2.515627861022949

-------------Round number: 15-------------

Evaluate global model
Averaged Train Loss: 0.9761
Averaged Test Accurancy: 0.6858
Averaged Test AUC: 0.9173
Std Test Accurancy: 0.3151
Std Test AUC: 0.1024
------------------------- time cost ------------------------- 2.524305820465088

-------------Round number: 16-------------

Evaluate global model
Averaged Train Loss: 0.8777
Averaged Test Accurancy: 0.7150
Averaged Test AUC: 0.9419
Std Test Accurancy: 0.1725
Std Test AUC: 0.0344
------------------------- time cost ------------------------- 2.691694736480713

-------------Round number: 17-------------

Evaluate global model
Averaged Train Loss: 0.8034
Averaged Test Accurancy: 0.7630
Averaged Test AUC: 0.9478
Std Test Accurancy: 0.1467
Std Test AUC: 0.0347
------------------------- time cost ------------------------- 2.7502920627593994

-------------Round number: 18-------------

Evaluate global model
Averaged Train Loss: 0.7763
Averaged Test Accurancy: 0.7752
Averaged Test AUC: 0.9502
Std Test Accurancy: 0.1158
Std Test AUC: 0.0274
------------------------- time cost ------------------------- 2.591468334197998

-------------Round number: 19-------------

Evaluate global model
Averaged Train Loss: 0.8579
Averaged Test Accurancy: 0.7213
Averaged Test AUC: 0.9340
Std Test Accurancy: 0.2891
Std Test AUC: 0.0788
------------------------- time cost ------------------------- 2.4526968002319336

-------------Round number: 20-------------

Evaluate global model
Averaged Train Loss: 0.8876
Averaged Test Accurancy: 0.7008
Averaged Test AUC: 0.9269
Std Test Accurancy: 0.3062
Std Test AUC: 0.0855
------------------------- time cost ------------------------- 2.547701597213745

-------------Round number: 21-------------

Evaluate global model
Averaged Train Loss: 0.7426
Averaged Test Accurancy: 0.7825
Averaged Test AUC: 0.9536
Std Test Accurancy: 0.0391
Std Test AUC: 0.0089
------------------------- time cost ------------------------- 2.6985881328582764

-------------Round number: 22-------------

Evaluate global model
Averaged Train Loss: 0.7082
Averaged Test Accurancy: 0.7879
Averaged Test AUC: 0.9534
Std Test Accurancy: 0.1137
Std Test AUC: 0.0261
------------------------- time cost ------------------------- 2.229203224182129

-------------Round number: 23-------------

Evaluate global model
Averaged Train Loss: 0.8067
Averaged Test Accurancy: 0.7196
Averaged Test AUC: 0.9423
Std Test Accurancy: 0.2123
Std Test AUC: 0.0422
------------------------- time cost ------------------------- 2.3563120365142822

-------------Round number: 24-------------

Evaluate global model
Averaged Train Loss: 0.8260
Averaged Test Accurancy: 0.7223
Averaged Test AUC: 0.9435
Std Test Accurancy: 0.1547
Std Test AUC: 0.0327
------------------------- time cost ------------------------- 2.7442386150360107

-------------Round number: 25-------------

Evaluate global model
Averaged Train Loss: 0.6696
Averaged Test Accurancy: 0.7952
Averaged Test AUC: 0.9556
Std Test Accurancy: 0.1153
Std Test AUC: 0.0251
------------------------- time cost ------------------------- 2.5081207752227783

-------------Round number: 26-------------

Evaluate global model
Averaged Train Loss: 0.7289
Averaged Test Accurancy: 0.7527
Averaged Test AUC: 0.9466
Std Test Accurancy: 0.2618
Std Test AUC: 0.0564
------------------------- time cost ------------------------- 2.521901845932007

-------------Round number: 27-------------

Evaluate global model
Averaged Train Loss: 0.7078
Averaged Test Accurancy: 0.7807
Averaged Test AUC: 0.9517
Std Test Accurancy: 0.1372
Std Test AUC: 0.0323
------------------------- time cost ------------------------- 2.6393370628356934

-------------Round number: 28-------------

Evaluate global model
Averaged Train Loss: 0.6418
Averaged Test Accurancy: 0.8042
Averaged Test AUC: 0.9566
Std Test Accurancy: 0.1136
Std Test AUC: 0.0262
------------------------- time cost ------------------------- 2.5841574668884277

-------------Round number: 29-------------

Evaluate global model
Averaged Train Loss: 0.6584
Averaged Test Accurancy: 0.7918
Averaged Test AUC: 0.9577
Std Test Accurancy: 0.1080
Std Test AUC: 0.0202
------------------------- time cost ------------------------- 2.362337112426758

-------------Round number: 30-------------

Evaluate global model
Averaged Train Loss: 0.7138
Averaged Test Accurancy: 0.7540
Averaged Test AUC: 0.9488
Std Test Accurancy: 0.2520
Std Test AUC: 0.0542
------------------------- time cost ------------------------- 2.4573047161102295

-------------Round number: 31-------------

Evaluate global model
Averaged Train Loss: 0.7172
Averaged Test Accurancy: 0.7495
Averaged Test AUC: 0.9456
Std Test Accurancy: 0.2618
Std Test AUC: 0.0583
------------------------- time cost ------------------------- 2.687901258468628

-------------Round number: 32-------------

Evaluate global model
Averaged Train Loss: 0.6032
Averaged Test Accurancy: 0.8188
Averaged Test AUC: 0.9607
Std Test Accurancy: 0.0892
Std Test AUC: 0.0184
------------------------- time cost ------------------------- 2.6498804092407227

-------------Round number: 33-------------

Evaluate global model
Averaged Train Loss: 0.6197
Averaged Test Accurancy: 0.8044
Averaged Test AUC: 0.9583
Std Test Accurancy: 0.1325
Std Test AUC: 0.0287
------------------------- time cost ------------------------- 2.522191047668457

-------------Round number: 34-------------

Evaluate global model
Averaged Train Loss: 0.6115
Averaged Test Accurancy: 0.8106
Averaged Test AUC: 0.9600
Std Test Accurancy: 0.0986
Std Test AUC: 0.0202
------------------------- time cost ------------------------- 2.363546848297119

-------------Round number: 35-------------

Evaluate global model
Averaged Train Loss: 0.7310
Averaged Test Accurancy: 0.7405
Averaged Test AUC: 0.9482
Std Test Accurancy: 0.2754
Std Test AUC: 0.0524
------------------------- time cost ------------------------- 2.659080743789673

-------------Round number: 36-------------

Evaluate global model
Averaged Train Loss: 0.5588
Averaged Test Accurancy: 0.8297
Averaged Test AUC: 0.9641
Std Test Accurancy: 0.0824
Std Test AUC: 0.0167
------------------------- time cost ------------------------- 2.567443370819092

-------------Round number: 37-------------

Evaluate global model
Averaged Train Loss: 0.6075
Averaged Test Accurancy: 0.8079
Averaged Test AUC: 0.9602
Std Test Accurancy: 0.0363
Std Test AUC: 0.0096
------------------------- time cost ------------------------- 2.6347053050994873

-------------Round number: 38-------------

Evaluate global model
Averaged Train Loss: 0.5446
Averaged Test Accurancy: 0.8357
Averaged Test AUC: 0.9649
Std Test Accurancy: 0.0773
Std Test AUC: 0.0161
------------------------- time cost ------------------------- 2.559115409851074

-------------Round number: 39-------------

Evaluate global model
Averaged Train Loss: 0.6233
Averaged Test Accurancy: 0.7828
Averaged Test AUC: 0.9559
Std Test Accurancy: 0.2494
Std Test AUC: 0.0489
------------------------- time cost ------------------------- 2.461092472076416

-------------Round number: 40-------------

Evaluate global model
Averaged Train Loss: 0.6068
Averaged Test Accurancy: 0.8072
Averaged Test AUC: 0.9594
Std Test Accurancy: 0.1361
Std Test AUC: 0.0290
------------------------- time cost ------------------------- 2.5256712436676025

-------------Round number: 41-------------

Evaluate global model
Averaged Train Loss: 0.5868
Averaged Test Accurancy: 0.8058
Averaged Test AUC: 0.9614
Std Test Accurancy: 0.1514
Std Test AUC: 0.0287
------------------------- time cost ------------------------- 2.475908041000366

-------------Round number: 42-------------

Evaluate global model
Averaged Train Loss: 0.5763
Averaged Test Accurancy: 0.8217
Averaged Test AUC: 0.9611
Std Test Accurancy: 0.1250
Std Test AUC: 0.0276
------------------------- time cost ------------------------- 2.5354318618774414

-------------Round number: 43-------------

Evaluate global model
Averaged Train Loss: 0.5347
Averaged Test Accurancy: 0.8347
Averaged Test AUC: 0.9651
Std Test Accurancy: 0.0823
Std Test AUC: 0.0166
------------------------- time cost ------------------------- 2.595444679260254

-------------Round number: 44-------------

Evaluate global model
Averaged Train Loss: 0.5140
Averaged Test Accurancy: 0.8429
Averaged Test AUC: 0.9674
Std Test Accurancy: 0.0805
Std Test AUC: 0.0169
------------------------- time cost ------------------------- 2.6391899585723877

-------------Round number: 45-------------

Evaluate global model
Averaged Train Loss: 0.5090
Averaged Test Accurancy: 0.8451
Averaged Test AUC: 0.9676
Std Test Accurancy: 0.0833
Std Test AUC: 0.0174
------------------------- time cost ------------------------- 2.5140607357025146

-------------Round number: 46-------------

Evaluate global model
Averaged Train Loss: 0.5987
Averaged Test Accurancy: 0.7942
Averaged Test AUC: 0.9580
Std Test Accurancy: 0.2617
Std Test AUC: 0.0516
------------------------- time cost ------------------------- 2.4526286125183105

-------------Round number: 47-------------

Evaluate global model
Averaged Train Loss: 0.5535
Averaged Test Accurancy: 0.8193
Averaged Test AUC: 0.9648
Std Test Accurancy: 0.1168
Std Test AUC: 0.0219
------------------------- time cost ------------------------- 2.573467493057251

-------------Round number: 48-------------

Evaluate global model
Averaged Train Loss: 0.5041
Averaged Test Accurancy: 0.8378
Averaged Test AUC: 0.9681
Std Test Accurancy: 0.1155
Std Test AUC: 0.0200
------------------------- time cost ------------------------- 2.398030996322632

-------------Round number: 49-------------

Evaluate global model
Averaged Train Loss: 0.5829
Averaged Test Accurancy: 0.7952
Averaged Test AUC: 0.9597
Std Test Accurancy: 0.2392
Std Test AUC: 0.0453
------------------------- time cost ------------------------- 2.6323907375335693

-------------Round number: 50-------------

Evaluate global model
Averaged Train Loss: 0.5114
Averaged Test Accurancy: 0.8368
Averaged Test AUC: 0.9667
Std Test Accurancy: 0.1166
Std Test AUC: 0.0241
------------------------- time cost ------------------------- 2.654442071914673

Best accuracy.
0.8450905352144856

Average time cost per round.
2.5480285835266114
File path: ../results/MNIST_FedAvg_test_0.h5

Average time cost: 130.92s.
Length:  51
std for best accurancy: 0.0
mean for best accurancy: 0.8450905352144856
All done!

Storage on cuda:0
-------------------------------------------------------------------------------
Total Tensors: 36085612 	Used Memory: 93.31M
The allocated memory on cuda:0: 110.06M
Memory differs due to the matrix alignment or invisible gradient buffer tensors
-------------------------------------------------------------------------------

Total time cost: 130.99s.

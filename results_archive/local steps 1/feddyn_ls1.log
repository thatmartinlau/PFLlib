==================================================
goal = test
device = cuda
device_id = 0
dataset = MNIST
num_classes = 10
model = CNN
batch_size = 64
local_learning_rate = 0.01
learning_rate_decay = False
learning_rate_decay_gamma = 0.99
global_rounds = 50
top_cnt = 100
local_epochs = 1
algorithm = FedDyn
join_ratio = 0.8
random_join_ratio = False
num_clients = 20
prev = 0
times = 1
eval_gap = 1
save_folder_name = items
auto_break = False
dlg_eval = False
dlg_gap = 100
batch_num_per_client = 2
num_new_clients = 0
fine_tuning_epoch_new = 0
feature_dim = 512
vocab_size = 32000
max_len = 200
client_drop_rate = 0.0
train_slow_rate = 0.0
send_slow_rate = 0.0
time_select = False
time_threthold = 10000
beta = 0.0
lamda = 1.0
mu = 0.0
K = 5
p_learning_rate = 0.01
M = 5
itk = 4000
alphaK = 1.0
sigma = 1.0
alpha = 1.0
plocal_epochs = 1
tau = 1.0
fine_tuning_epochs = 10
dr_learning_rate = 0.0
L = 1.0
noise_dim = 512
generator_learning_rate = 0.005
hidden_dim = 512
server_epochs = 1000
localize_feature_extractor = False
server_learning_rate = 1.0
eta = 1.0
rand_percent = 80
layer_idx = 2
mentee_learning_rate = 0.005
T_start = 0.95
T_end = 0.98
momentum = 0.1
kl_weight = 0.0
prune_interval = 5
prune_amount = 0.5
==================================================

============= Running time: 0th =============
Creating server and clients ...
FedAvgCNN(
  (conv1): Sequential(
    (0): Conv2d(1, 32, kernel_size=(5, 5), stride=(1, 1))
    (1): ReLU(inplace=True)
    (2): MaxPool2d(kernel_size=(2, 2), stride=(2, 2), padding=0, dilation=1, ceil_mode=False)
  )
  (conv2): Sequential(
    (0): Conv2d(32, 64, kernel_size=(5, 5), stride=(1, 1))
    (1): ReLU(inplace=True)
    (2): MaxPool2d(kernel_size=(2, 2), stride=(2, 2), padding=0, dilation=1, ceil_mode=False)
  )
  (fc1): Sequential(
    (0): Linear(in_features=1024, out_features=512, bias=True)
    (1): ReLU(inplace=True)
  )
  (fc): Linear(in_features=512, out_features=10, bias=True)
)

Join ratio / total clients: 0.8 / 20
Finished creating server and clients.

-------------Round number: 0-------------

Evaluate global model
Averaged Train Loss: 2.3125
Averaged Test Accurancy: 0.0583
Averaged Test AUC: 0.4299
Std Test Accurancy: 0.0526
Std Test AUC: 0.1484
-------------------------------------------------- 3.2519683837890625

-------------Round number: 1-------------

Evaluate global model
Averaged Train Loss: 2.9307
Averaged Test Accurancy: 0.1706
Averaged Test AUC: 0.5609
Std Test Accurancy: 0.2345
Std Test AUC: 0.3194
-------------------------------------------------- 3.02941632270813

-------------Round number: 2-------------

Evaluate global model
Averaged Train Loss: 2.9454
Averaged Test Accurancy: 0.1598
Averaged Test AUC: 0.6448
Std Test Accurancy: 0.2336
Std Test AUC: 0.2736
-------------------------------------------------- 2.698547124862671

-------------Round number: 3-------------

Evaluate global model
Averaged Train Loss: 2.5537
Averaged Test Accurancy: 0.4199
Averaged Test AUC: 0.8202
Std Test Accurancy: 0.3239
Std Test AUC: 0.1521
-------------------------------------------------- 3.0363454818725586

-------------Round number: 4-------------

Evaluate global model
Averaged Train Loss: 2.3522
Averaged Test Accurancy: 0.5201
Averaged Test AUC: 0.8704
Std Test Accurancy: 0.3633
Std Test AUC: 0.1217
-------------------------------------------------- 2.9247782230377197

-------------Round number: 5-------------

Evaluate global model
Averaged Train Loss: 2.1812
Averaged Test Accurancy: 0.6180
Averaged Test AUC: 0.9195
Std Test Accurancy: 0.2124
Std Test AUC: 0.0421
-------------------------------------------------- 2.8423545360565186

-------------Round number: 6-------------

Evaluate global model
Averaged Train Loss: 2.0513
Averaged Test Accurancy: 0.6902
Averaged Test AUC: 0.9305
Std Test Accurancy: 0.1486
Std Test AUC: 0.0309
-------------------------------------------------- 3.099439859390259

-------------Round number: 7-------------

Evaluate global model
Averaged Train Loss: 1.8385
Averaged Test Accurancy: 0.7324
Averaged Test AUC: 0.9409
Std Test Accurancy: 0.1099
Std Test AUC: 0.0223
-------------------------------------------------- 3.108182191848755

-------------Round number: 8-------------

Evaluate global model
Averaged Train Loss: 1.6861
Averaged Test Accurancy: 0.7531
Averaged Test AUC: 0.9453
Std Test Accurancy: 0.0656
Std Test AUC: 0.0171
-------------------------------------------------- 2.6387109756469727

-------------Round number: 9-------------

Evaluate global model
Averaged Train Loss: 1.5882
Averaged Test Accurancy: 0.7651
Averaged Test AUC: 0.9466
Std Test Accurancy: 0.0947
Std Test AUC: 0.0252
-------------------------------------------------- 3.041961669921875

-------------Round number: 10-------------

Evaluate global model
Averaged Train Loss: 1.4690
Averaged Test Accurancy: 0.7546
Averaged Test AUC: 0.9451
Std Test Accurancy: 0.1985
Std Test AUC: 0.0398
-------------------------------------------------- 2.9700448513031006

-------------Round number: 11-------------

Evaluate global model
Averaged Train Loss: 1.3343
Averaged Test Accurancy: 0.7844
Averaged Test AUC: 0.9488
Std Test Accurancy: 0.1597
Std Test AUC: 0.0324
-------------------------------------------------- 2.856719493865967

-------------Round number: 12-------------

Evaluate global model
Averaged Train Loss: 1.3164
Averaged Test Accurancy: 0.7582
Averaged Test AUC: 0.9506
Std Test Accurancy: 0.1773
Std Test AUC: 0.0297
-------------------------------------------------- 2.9176857471466064

-------------Round number: 13-------------

Evaluate global model
Averaged Train Loss: 1.1604
Averaged Test Accurancy: 0.7797
Averaged Test AUC: 0.9539
Std Test Accurancy: 0.2180
Std Test AUC: 0.0346
-------------------------------------------------- 2.8585801124572754

-------------Round number: 14-------------

Evaluate global model
Averaged Train Loss: 1.0626
Averaged Test Accurancy: 0.7892
Averaged Test AUC: 0.9531
Std Test Accurancy: 0.2266
Std Test AUC: 0.0398
-------------------------------------------------- 3.0973145961761475

-------------Round number: 15-------------

Evaluate global model
Averaged Train Loss: 0.9301
Averaged Test Accurancy: 0.8423
Averaged Test AUC: 0.9580
Std Test Accurancy: 0.0834
Std Test AUC: 0.0222
-------------------------------------------------- 2.8073267936706543

-------------Round number: 16-------------

Evaluate global model
Averaged Train Loss: 0.8828
Averaged Test Accurancy: 0.8485
Averaged Test AUC: 0.9620
Std Test Accurancy: 0.0849
Std Test AUC: 0.0165
-------------------------------------------------- 2.661309003829956

-------------Round number: 17-------------

Evaluate global model
Averaged Train Loss: 0.8608
Averaged Test Accurancy: 0.8613
Averaged Test AUC: 0.9638
Std Test Accurancy: 0.0609
Std Test AUC: 0.0136
-------------------------------------------------- 2.7376370429992676

-------------Round number: 18-------------

Evaluate global model
Averaged Train Loss: 0.8607
Averaged Test Accurancy: 0.8473
Averaged Test AUC: 0.9613
Std Test Accurancy: 0.1262
Std Test AUC: 0.0291
-------------------------------------------------- 2.9362282752990723

-------------Round number: 19-------------

Evaluate global model
Averaged Train Loss: 0.8145
Averaged Test Accurancy: 0.8685
Averaged Test AUC: 0.9659
Std Test Accurancy: 0.0741
Std Test AUC: 0.0173
-------------------------------------------------- 2.8410141468048096

-------------Round number: 20-------------

Evaluate global model
Averaged Train Loss: 0.7920
Averaged Test Accurancy: 0.8760
Averaged Test AUC: 0.9677
Std Test Accurancy: 0.0578
Std Test AUC: 0.0165
-------------------------------------------------- 2.84273099899292

-------------Round number: 21-------------

Evaluate global model
Averaged Train Loss: 0.7653
Averaged Test Accurancy: 0.8814
Averaged Test AUC: 0.9707
Std Test Accurancy: 0.0480
Std Test AUC: 0.0113
-------------------------------------------------- 2.6839759349823

-------------Round number: 22-------------

Evaluate global model
Averaged Train Loss: 0.7436
Averaged Test Accurancy: 0.8796
Averaged Test AUC: 0.9715
Std Test Accurancy: 0.0632
Std Test AUC: 0.0128
-------------------------------------------------- 2.8176004886627197

-------------Round number: 23-------------

Evaluate global model
Averaged Train Loss: 0.7413
Averaged Test Accurancy: 0.8733
Averaged Test AUC: 0.9715
Std Test Accurancy: 0.0728
Std Test AUC: 0.0143
-------------------------------------------------- 2.871852159500122

-------------Round number: 24-------------

Evaluate global model
Averaged Train Loss: 0.7256
Averaged Test Accurancy: 0.8600
Averaged Test AUC: 0.9701
Std Test Accurancy: 0.1037
Std Test AUC: 0.0193
-------------------------------------------------- 2.8105485439300537

-------------Round number: 25-------------

Evaluate global model
Averaged Train Loss: 0.7280
Averaged Test Accurancy: 0.8588
Averaged Test AUC: 0.9703
Std Test Accurancy: 0.1092
Std Test AUC: 0.0201
-------------------------------------------------- 2.8093936443328857

-------------Round number: 26-------------

Evaluate global model
Averaged Train Loss: 0.6597
Averaged Test Accurancy: 0.8971
Averaged Test AUC: 0.9728
Std Test Accurancy: 0.0589
Std Test AUC: 0.0128
-------------------------------------------------- 2.809316396713257

-------------Round number: 27-------------

Evaluate global model
Averaged Train Loss: 0.6667
Averaged Test Accurancy: 0.9045
Averaged Test AUC: 0.9738
Std Test Accurancy: 0.0462
Std Test AUC: 0.0152
-------------------------------------------------- 2.933589220046997

-------------Round number: 28-------------

Evaluate global model
Averaged Train Loss: 0.6932
Averaged Test Accurancy: 0.8791
Averaged Test AUC: 0.9737
Std Test Accurancy: 0.0899
Std Test AUC: 0.0207
-------------------------------------------------- 2.805497646331787

-------------Round number: 29-------------

Evaluate global model
Averaged Train Loss: 0.6296
Averaged Test Accurancy: 0.9063
Averaged Test AUC: 0.9786
Std Test Accurancy: 0.0478
Std Test AUC: 0.0122
-------------------------------------------------- 2.917776584625244

-------------Round number: 30-------------

Evaluate global model
Averaged Train Loss: 0.6391
Averaged Test Accurancy: 0.9070
Averaged Test AUC: 0.9784
Std Test Accurancy: 0.0432
Std Test AUC: 0.0120
-------------------------------------------------- 2.9999613761901855

-------------Round number: 31-------------

Evaluate global model
Averaged Train Loss: 0.6219
Averaged Test Accurancy: 0.9012
Averaged Test AUC: 0.9797
Std Test Accurancy: 0.0576
Std Test AUC: 0.0113
-------------------------------------------------- 2.9023444652557373

-------------Round number: 32-------------

Evaluate global model
Averaged Train Loss: 0.6361
Averaged Test Accurancy: 0.8862
Averaged Test AUC: 0.9789
Std Test Accurancy: 0.0663
Std Test AUC: 0.0111
-------------------------------------------------- 2.6891698837280273

-------------Round number: 33-------------

Evaluate global model
Averaged Train Loss: 0.6331
Averaged Test Accurancy: 0.8896
Averaged Test AUC: 0.9777
Std Test Accurancy: 0.1089
Std Test AUC: 0.0234
-------------------------------------------------- 2.8076517581939697

-------------Round number: 34-------------

Evaluate global model
Averaged Train Loss: 0.9957
Averaged Test Accurancy: 0.7282
Averaged Test AUC: 0.9485
Std Test Accurancy: 0.3064
Std Test AUC: 0.0598
-------------------------------------------------- 2.799607276916504

-------------Round number: 35-------------

Evaluate global model
Averaged Train Loss: 1.2961
Averaged Test Accurancy: 0.7059
Averaged Test AUC: 0.9134
Std Test Accurancy: 0.3587
Std Test AUC: 0.1390
-------------------------------------------------- 2.7368791103363037

-------------Round number: 36-------------

Evaluate global model
Averaged Train Loss: 0.7179
Averaged Test Accurancy: 0.8677
Averaged Test AUC: 0.9742
Std Test Accurancy: 0.1118
Std Test AUC: 0.0208
-------------------------------------------------- 2.888810396194458

-------------Round number: 37-------------

Evaluate global model
Averaged Train Loss: 0.6980
Averaged Test Accurancy: 0.8756
Averaged Test AUC: 0.9775
Std Test Accurancy: 0.0931
Std Test AUC: 0.0155
-------------------------------------------------- 2.9369659423828125

-------------Round number: 38-------------

Evaluate global model
Averaged Train Loss: 0.7367
Averaged Test Accurancy: 0.8473
Averaged Test AUC: 0.9722
Std Test Accurancy: 0.1056
Std Test AUC: 0.0194
-------------------------------------------------- 2.9069716930389404

-------------Round number: 39-------------

Evaluate global model
Averaged Train Loss: 0.6637
Averaged Test Accurancy: 0.8855
Averaged Test AUC: 0.9775
Std Test Accurancy: 0.0567
Std Test AUC: 0.0091
-------------------------------------------------- 2.959540843963623

-------------Round number: 40-------------

Evaluate global model
Averaged Train Loss: 0.6936
Averaged Test Accurancy: 0.8677
Averaged Test AUC: 0.9739
Std Test Accurancy: 0.1212
Std Test AUC: 0.0221
-------------------------------------------------- 2.651756525039673

-------------Round number: 41-------------

Evaluate global model
Averaged Train Loss: 0.6030
Averaged Test Accurancy: 0.9079
Averaged Test AUC: 0.9800
Std Test Accurancy: 0.0470
Std Test AUC: 0.0101
-------------------------------------------------- 2.8704659938812256

-------------Round number: 42-------------

Evaluate global model
Averaged Train Loss: 0.5918
Averaged Test Accurancy: 0.9041
Averaged Test AUC: 0.9801
Std Test Accurancy: 0.0437
Std Test AUC: 0.0082
-------------------------------------------------- 2.6783628463745117

-------------Round number: 43-------------

Evaluate global model
Averaged Train Loss: 0.6210
Averaged Test Accurancy: 0.8736
Averaged Test AUC: 0.9780
Std Test Accurancy: 0.0804
Std Test AUC: 0.0135
-------------------------------------------------- 2.849543809890747

-------------Round number: 44-------------

Evaluate global model
Averaged Train Loss: 0.6001
Averaged Test Accurancy: 0.8900
Averaged Test AUC: 0.9754
Std Test Accurancy: 0.1168
Std Test AUC: 0.0256
-------------------------------------------------- 2.9235737323760986

-------------Round number: 45-------------

Evaluate global model
Averaged Train Loss: 0.5736
Averaged Test Accurancy: 0.8826
Averaged Test AUC: 0.9768
Std Test Accurancy: 0.0725
Std Test AUC: 0.0119
-------------------------------------------------- 3.0554327964782715

-------------Round number: 46-------------

Evaluate global model
Averaged Train Loss: 0.5320
Averaged Test Accurancy: 0.9089
Averaged Test AUC: 0.9803
Std Test Accurancy: 0.0657
Std Test AUC: 0.0121
-------------------------------------------------- 2.9819083213806152

-------------Round number: 47-------------

Evaluate global model
Averaged Train Loss: 0.5040
Averaged Test Accurancy: 0.9272
Averaged Test AUC: 0.9834
Std Test Accurancy: 0.0318
Std Test AUC: 0.0074
-------------------------------------------------- 2.7404274940490723

-------------Round number: 48-------------

Evaluate global model
Averaged Train Loss: 0.5159
Averaged Test Accurancy: 0.9188
Averaged Test AUC: 0.9833
Std Test Accurancy: 0.0652
Std Test AUC: 0.0120
-------------------------------------------------- 2.8511593341827393

-------------Round number: 49-------------

Evaluate global model
Averaged Train Loss: 0.5216
Averaged Test Accurancy: 0.9186
Averaged Test AUC: 0.9835
Std Test Accurancy: 0.0567
Std Test AUC: 0.0108
-------------------------------------------------- 2.675534248352051

-------------Round number: 50-------------

Evaluate global model
Averaged Train Loss: 0.5056
Averaged Test Accurancy: 0.9243
Averaged Test AUC: 0.9844
Std Test Accurancy: 0.0478
Std Test AUC: 0.0088
-------------------------------------------------- 2.8881258964538574

Best accuracy.
0.9271719883475181

Best local accuracy.

Averaged time per iteration.
2.8640014362335204
File path: ../results/MNIST_FedDyn_test_0.h5

Average time cost: 147.2s.
Length:  51
std for best accurancy: 0.0
mean for best accurancy: 0.9271719883475181
All done!

Storage on cuda:0
-------------------------------------------------------------------------------
Total Tensors: 59948678 	Used Memory: 184.36M
The allocated memory on cuda:0: 209.79M
Memory differs due to the matrix alignment or invisible gradient buffer tensors
-------------------------------------------------------------------------------

Total time cost: 147.28s.

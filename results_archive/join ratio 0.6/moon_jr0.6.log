==================================================
goal = test
device = cuda
device_id = 0
dataset = MNIST
num_classes = 10
model = CNN
batch_size = 64
local_learning_rate = 0.01
learning_rate_decay = False
learning_rate_decay_gamma = 0.99
global_rounds = 50
top_cnt = 100
local_epochs = 5
algorithm = MOON
join_ratio = 0.6
random_join_ratio = False
num_clients = 20
prev = 0
times = 1
eval_gap = 1
save_folder_name = items
auto_break = False
dlg_eval = False
dlg_gap = 100
batch_num_per_client = 2
num_new_clients = 0
fine_tuning_epoch_new = 0
feature_dim = 512
vocab_size = 32000
max_len = 200
client_drop_rate = 0.0
train_slow_rate = 0.0
send_slow_rate = 0.0
time_select = False
time_threthold = 10000
beta = 0.0
lamda = 1.0
mu = 0.0
K = 5
p_learning_rate = 0.01
M = 5
itk = 4000
alphaK = 1.0
sigma = 1.0
alpha = 1.0
plocal_epochs = 1
tau = 1.0
fine_tuning_epochs = 10
dr_learning_rate = 0.0
L = 1.0
noise_dim = 512
generator_learning_rate = 0.005
hidden_dim = 512
server_epochs = 1000
localize_feature_extractor = False
server_learning_rate = 1.0
eta = 1.0
rand_percent = 80
layer_idx = 2
mentee_learning_rate = 0.005
T_start = 0.95
T_end = 0.98
momentum = 0.1
kl_weight = 0.0
prune_interval = 5
prune_amount = 0.5
==================================================

============= Running time: 0th =============
Creating server and clients ...
FedAvgCNN(
  (conv1): Sequential(
    (0): Conv2d(1, 32, kernel_size=(5, 5), stride=(1, 1))
    (1): ReLU(inplace=True)
    (2): MaxPool2d(kernel_size=(2, 2), stride=(2, 2), padding=0, dilation=1, ceil_mode=False)
  )
  (conv2): Sequential(
    (0): Conv2d(32, 64, kernel_size=(5, 5), stride=(1, 1))
    (1): ReLU(inplace=True)
    (2): MaxPool2d(kernel_size=(2, 2), stride=(2, 2), padding=0, dilation=1, ceil_mode=False)
  )
  (fc1): Sequential(
    (0): Linear(in_features=1024, out_features=512, bias=True)
    (1): ReLU(inplace=True)
  )
  (fc): Linear(in_features=512, out_features=10, bias=True)
)

Join ratio / total clients: 0.6 / 20
Finished creating server and clients.

-------------Round number: 0-------------

Evaluate global model
Averaged Train Loss: 2.3125
Averaged Test Accurancy: 0.0583
Averaged Test AUC: 0.4299
Std Test Accurancy: 0.0526
Std Test AUC: 0.1484
-------------------------------------------------- 9.848123788833618

-------------Round number: 1-------------

Evaluate global model
Averaged Train Loss: 2.1976
Averaged Test Accurancy: 0.3751
Averaged Test AUC: 0.6424
Std Test Accurancy: 0.3831
Std Test AUC: 0.3733
-------------------------------------------------- 7.718233346939087

-------------Round number: 2-------------

Evaluate global model
Averaged Train Loss: 2.1115
Averaged Test Accurancy: 0.3064
Averaged Test AUC: 0.7052
Std Test Accurancy: 0.3919
Std Test AUC: 0.2197
-------------------------------------------------- 10.377168655395508

-------------Round number: 3-------------

Evaluate global model
Averaged Train Loss: 1.5764
Averaged Test Accurancy: 0.6130
Averaged Test AUC: 0.8165
Std Test Accurancy: 0.3272
Std Test AUC: 0.2941
-------------------------------------------------- 9.039110898971558

-------------Round number: 4-------------

Evaluate global model
Averaged Train Loss: 1.5177
Averaged Test Accurancy: 0.4780
Averaged Test AUC: 0.8243
Std Test Accurancy: 0.3984
Std Test AUC: 0.1771
-------------------------------------------------- 8.851113557815552

-------------Round number: 5-------------

Evaluate global model
Averaged Train Loss: 1.3236
Averaged Test Accurancy: 0.5130
Averaged Test AUC: 0.8898
Std Test Accurancy: 0.3301
Std Test AUC: 0.1081
-------------------------------------------------- 8.086827754974365

-------------Round number: 6-------------

Evaluate global model
Averaged Train Loss: 1.3420
Averaged Test Accurancy: 0.4889
Averaged Test AUC: 0.8719
Std Test Accurancy: 0.3918
Std Test AUC: 0.1063
-------------------------------------------------- 7.88289999961853

-------------Round number: 7-------------

Evaluate global model
Averaged Train Loss: 1.2443
Averaged Test Accurancy: 0.5154
Averaged Test AUC: 0.8808
Std Test Accurancy: 0.3913
Std Test AUC: 0.1057
-------------------------------------------------- 8.35731816291809

-------------Round number: 8-------------

Evaluate global model
Averaged Train Loss: 1.0373
Averaged Test Accurancy: 0.6424
Averaged Test AUC: 0.9269
Std Test Accurancy: 0.2241
Std Test AUC: 0.0536
-------------------------------------------------- 7.65754246711731

-------------Round number: 9-------------

Evaluate global model
Averaged Train Loss: 1.1319
Averaged Test Accurancy: 0.5878
Averaged Test AUC: 0.9173
Std Test Accurancy: 0.2742
Std Test AUC: 0.0692
-------------------------------------------------- 8.529704332351685

-------------Round number: 10-------------

Evaluate global model
Averaged Train Loss: 0.8838
Averaged Test Accurancy: 0.6916
Averaged Test AUC: 0.9342
Std Test Accurancy: 0.2651
Std Test AUC: 0.0638
-------------------------------------------------- 8.506096839904785

-------------Round number: 11-------------

Evaluate global model
Averaged Train Loss: 0.9049
Averaged Test Accurancy: 0.6694
Averaged Test AUC: 0.9297
Std Test Accurancy: 0.2148
Std Test AUC: 0.0513
-------------------------------------------------- 6.495177984237671

-------------Round number: 12-------------

Evaluate global model
Averaged Train Loss: 0.9432
Averaged Test Accurancy: 0.6386
Averaged Test AUC: 0.9337
Std Test Accurancy: 0.2839
Std Test AUC: 0.0543
-------------------------------------------------- 8.77660608291626

-------------Round number: 13-------------

Evaluate global model
Averaged Train Loss: 1.0831
Averaged Test Accurancy: 0.6243
Averaged Test AUC: 0.9117
Std Test Accurancy: 0.3866
Std Test AUC: 0.0982
-------------------------------------------------- 10.168329954147339

-------------Round number: 14-------------

Evaluate global model
Averaged Train Loss: 0.7810
Averaged Test Accurancy: 0.7419
Averaged Test AUC: 0.9478
Std Test Accurancy: 0.1720
Std Test AUC: 0.0362
-------------------------------------------------- 9.17052173614502

-------------Round number: 15-------------

Evaluate global model
Averaged Train Loss: 0.8902
Averaged Test Accurancy: 0.6570
Averaged Test AUC: 0.9364
Std Test Accurancy: 0.2707
Std Test AUC: 0.0505
-------------------------------------------------- 7.632153272628784

-------------Round number: 16-------------

Evaluate global model
Averaged Train Loss: 0.8538
Averaged Test Accurancy: 0.6778
Averaged Test AUC: 0.9444
Std Test Accurancy: 0.2097
Std Test AUC: 0.0406
-------------------------------------------------- 8.711167812347412

-------------Round number: 17-------------

Evaluate global model
Averaged Train Loss: 0.7675
Averaged Test Accurancy: 0.7445
Averaged Test AUC: 0.9493
Std Test Accurancy: 0.1986
Std Test AUC: 0.0440
-------------------------------------------------- 8.229509353637695

-------------Round number: 18-------------

Evaluate global model
Averaged Train Loss: 0.8395
Averaged Test Accurancy: 0.7141
Averaged Test AUC: 0.9391
Std Test Accurancy: 0.3015
Std Test AUC: 0.0712
-------------------------------------------------- 7.517045259475708

-------------Round number: 19-------------

Evaluate global model
Averaged Train Loss: 0.7777
Averaged Test Accurancy: 0.7361
Averaged Test AUC: 0.9504
Std Test Accurancy: 0.2357
Std Test AUC: 0.0492
-------------------------------------------------- 8.4207923412323

-------------Round number: 20-------------

Evaluate global model
Averaged Train Loss: 0.7813
Averaged Test Accurancy: 0.7317
Averaged Test AUC: 0.9457
Std Test Accurancy: 0.2623
Std Test AUC: 0.0588
-------------------------------------------------- 8.342607975006104

-------------Round number: 21-------------

Evaluate global model
Averaged Train Loss: 0.8082
Averaged Test Accurancy: 0.7151
Averaged Test AUC: 0.9495
Std Test Accurancy: 0.2241
Std Test AUC: 0.0464
-------------------------------------------------- 5.518206596374512

-------------Round number: 22-------------

Evaluate global model
Averaged Train Loss: 0.5155
Averaged Test Accurancy: 0.8442
Averaged Test AUC: 0.9681
Std Test Accurancy: 0.0899
Std Test AUC: 0.0181
-------------------------------------------------- 7.254644393920898

-------------Round number: 23-------------

Evaluate global model
Averaged Train Loss: 0.6303
Averaged Test Accurancy: 0.7745
Averaged Test AUC: 0.9586
Std Test Accurancy: 0.2222
Std Test AUC: 0.0387
-------------------------------------------------- 8.96848440170288

-------------Round number: 24-------------

Evaluate global model
Averaged Train Loss: 0.6947
Averaged Test Accurancy: 0.7505
Averaged Test AUC: 0.9473
Std Test Accurancy: 0.2659
Std Test AUC: 0.0611
-------------------------------------------------- 9.04014539718628

-------------Round number: 25-------------

Evaluate global model
Averaged Train Loss: 0.5866
Averaged Test Accurancy: 0.8055
Averaged Test AUC: 0.9634
Std Test Accurancy: 0.1504
Std Test AUC: 0.0309
-------------------------------------------------- 7.383954286575317

-------------Round number: 26-------------

Evaluate global model
Averaged Train Loss: 0.9280
Averaged Test Accurancy: 0.6862
Averaged Test AUC: 0.9409
Std Test Accurancy: 0.3168
Std Test AUC: 0.0633
-------------------------------------------------- 8.75153660774231

-------------Round number: 27-------------

Evaluate global model
Averaged Train Loss: 0.6322
Averaged Test Accurancy: 0.7691
Averaged Test AUC: 0.9562
Std Test Accurancy: 0.2549
Std Test AUC: 0.0482
-------------------------------------------------- 7.440007925033569

-------------Round number: 28-------------

Evaluate global model
Averaged Train Loss: 0.8100
Averaged Test Accurancy: 0.6970
Averaged Test AUC: 0.9411
Std Test Accurancy: 0.2923
Std Test AUC: 0.0672
-------------------------------------------------- 9.29911994934082

-------------Round number: 29-------------

Evaluate global model
Averaged Train Loss: 0.4944
Averaged Test Accurancy: 0.8360
Averaged Test AUC: 0.9699
Std Test Accurancy: 0.0624
Std Test AUC: 0.0080
-------------------------------------------------- 8.806544303894043

-------------Round number: 30-------------

Evaluate global model
Averaged Train Loss: 0.5209
Averaged Test Accurancy: 0.8173
Averaged Test AUC: 0.9667
Std Test Accurancy: 0.2230
Std Test AUC: 0.0404
-------------------------------------------------- 7.350746393203735

-------------Round number: 31-------------

Evaluate global model
Averaged Train Loss: 0.6505
Averaged Test Accurancy: 0.7758
Averaged Test AUC: 0.9608
Std Test Accurancy: 0.1369
Std Test AUC: 0.0210
-------------------------------------------------- 9.814892530441284

-------------Round number: 32-------------

Evaluate global model
Averaged Train Loss: 0.4796
Averaged Test Accurancy: 0.8455
Averaged Test AUC: 0.9707
Std Test Accurancy: 0.0933
Std Test AUC: 0.0181
-------------------------------------------------- 8.18696403503418

-------------Round number: 33-------------

Evaluate global model
Averaged Train Loss: 0.6082
Averaged Test Accurancy: 0.7733
Averaged Test AUC: 0.9599
Std Test Accurancy: 0.2478
Std Test AUC: 0.0469
-------------------------------------------------- 7.67288875579834

-------------Round number: 34-------------

Evaluate global model
Averaged Train Loss: 0.6551
Averaged Test Accurancy: 0.7767
Averaged Test AUC: 0.9614
Std Test Accurancy: 0.1971
Std Test AUC: 0.0358
-------------------------------------------------- 8.674644470214844

-------------Round number: 35-------------

Evaluate global model
Averaged Train Loss: 0.5082
Averaged Test Accurancy: 0.8182
Averaged Test AUC: 0.9653
Std Test Accurancy: 0.2284
Std Test AUC: 0.0450
-------------------------------------------------- 10.548640251159668

-------------Round number: 36-------------

Evaluate global model
Averaged Train Loss: 0.3781
Averaged Test Accurancy: 0.8834
Averaged Test AUC: 0.9779
Std Test Accurancy: 0.0631
Std Test AUC: 0.0117
-------------------------------------------------- 8.596955060958862

-------------Round number: 37-------------

Evaluate global model
Averaged Train Loss: 0.5658
Averaged Test Accurancy: 0.7905
Averaged Test AUC: 0.9645
Std Test Accurancy: 0.2519
Std Test AUC: 0.0417
-------------------------------------------------- 9.070414066314697

-------------Round number: 38-------------

Evaluate global model
Averaged Train Loss: 0.5171
Averaged Test Accurancy: 0.8223
Averaged Test AUC: 0.9688
Std Test Accurancy: 0.1578
Std Test AUC: 0.0285
-------------------------------------------------- 9.137798547744751

-------------Round number: 39-------------

Evaluate global model
Averaged Train Loss: 0.4248
Averaged Test Accurancy: 0.8590
Averaged Test AUC: 0.9745
Std Test Accurancy: 0.0859
Std Test AUC: 0.0158
-------------------------------------------------- 8.42839789390564

-------------Round number: 40-------------

Evaluate global model
Averaged Train Loss: 0.4094
Averaged Test Accurancy: 0.8731
Averaged Test AUC: 0.9762
Std Test Accurancy: 0.0908
Std Test AUC: 0.0154
-------------------------------------------------- 9.772817134857178

-------------Round number: 41-------------

Evaluate global model
Averaged Train Loss: 0.4119
Averaged Test Accurancy: 0.8563
Averaged Test AUC: 0.9730
Std Test Accurancy: 0.1852
Std Test AUC: 0.0343
-------------------------------------------------- 9.82766604423523

-------------Round number: 42-------------

Evaluate global model
Averaged Train Loss: 0.4796
Averaged Test Accurancy: 0.8293
Averaged Test AUC: 0.9670
Std Test Accurancy: 0.2555
Std Test AUC: 0.0488
-------------------------------------------------- 7.3986289501190186

-------------Round number: 43-------------

Evaluate global model
Averaged Train Loss: 0.4504
Averaged Test Accurancy: 0.8412
Averaged Test AUC: 0.9700
Std Test Accurancy: 0.1060
Std Test AUC: 0.0230
-------------------------------------------------- 9.953857660293579

-------------Round number: 44-------------

Evaluate global model
Averaged Train Loss: 0.4992
Averaged Test Accurancy: 0.8220
Averaged Test AUC: 0.9648
Std Test Accurancy: 0.2657
Std Test AUC: 0.0542
-------------------------------------------------- 8.7583909034729

-------------Round number: 45-------------

Evaluate global model
Averaged Train Loss: 0.5316
Averaged Test Accurancy: 0.8097
Averaged Test AUC: 0.9646
Std Test Accurancy: 0.2638
Std Test AUC: 0.0486
-------------------------------------------------- 8.434973955154419

-------------Round number: 46-------------

Evaluate global model
Averaged Train Loss: 0.4496
Averaged Test Accurancy: 0.8502
Averaged Test AUC: 0.9706
Std Test Accurancy: 0.1227
Std Test AUC: 0.0252
-------------------------------------------------- 8.280540466308594

-------------Round number: 47-------------

Evaluate global model
Averaged Train Loss: 0.4629
Averaged Test Accurancy: 0.8386
Averaged Test AUC: 0.9735
Std Test Accurancy: 0.1226
Std Test AUC: 0.0215
-------------------------------------------------- 9.011418581008911

-------------Round number: 48-------------

Evaluate global model
Averaged Train Loss: 0.3721
Averaged Test Accurancy: 0.8751
Averaged Test AUC: 0.9762
Std Test Accurancy: 0.0876
Std Test AUC: 0.0158
-------------------------------------------------- 10.61329698562622

-------------Round number: 49-------------

Evaluate global model
Averaged Train Loss: 0.2959
Averaged Test Accurancy: 0.9091
Averaged Test AUC: 0.9829
Std Test Accurancy: 0.0521
Std Test AUC: 0.0108
-------------------------------------------------- 8.308308601379395

-------------Round number: 50-------------

Evaluate global model
Averaged Train Loss: 0.4309
Averaged Test Accurancy: 0.8553
Averaged Test AUC: 0.9754
Std Test Accurancy: 0.1121
Std Test AUC: 0.0186
-------------------------------------------------- 7.751366376876831

Best accuracy.
0.9090649454503913

Best local accuracy.

Averaged time per iteration.
8.530523586273194
File path: ../results/MNIST_MOON_test_0.h5

Average time cost: 437.12s.
Length:  51
std for best accurancy: 0.0
mean for best accurancy: 0.9090649454503913
All done!

Storage on cuda:0
-------------------------------------------------------------------------------
Total Tensors: 48308158 	Used Memory: 139.97M
The allocated memory on cuda:0: 156.97M
Memory differs due to the matrix alignment or invisible gradient buffer tensors
-------------------------------------------------------------------------------

Total time cost: 437.19s.

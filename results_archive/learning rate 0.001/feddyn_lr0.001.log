==================================================
goal = test
device = cuda
device_id = 0
dataset = MNIST
num_classes = 10
model = CNN
batch_size = 64
local_learning_rate = 0.001
learning_rate_decay = False
learning_rate_decay_gamma = 0.99
global_rounds = 50
top_cnt = 100
local_epochs = 5
algorithm = FedDyn
join_ratio = 0.8
random_join_ratio = False
num_clients = 20
prev = 0
times = 1
eval_gap = 1
save_folder_name = items
auto_break = False
dlg_eval = False
dlg_gap = 100
batch_num_per_client = 2
num_new_clients = 0
fine_tuning_epoch_new = 0
feature_dim = 512
vocab_size = 32000
max_len = 200
client_drop_rate = 0.0
train_slow_rate = 0.0
send_slow_rate = 0.0
time_select = False
time_threthold = 10000
beta = 0.0
lamda = 1.0
mu = 0.0
K = 5
p_learning_rate = 0.01
M = 5
itk = 4000
alphaK = 1.0
sigma = 1.0
alpha = 1.0
plocal_epochs = 1
tau = 1.0
fine_tuning_epochs = 10
dr_learning_rate = 0.0
L = 1.0
noise_dim = 512
generator_learning_rate = 0.005
hidden_dim = 512
server_epochs = 1000
localize_feature_extractor = False
server_learning_rate = 1.0
eta = 1.0
rand_percent = 80
layer_idx = 2
mentee_learning_rate = 0.005
T_start = 0.95
T_end = 0.98
momentum = 0.1
kl_weight = 0.0
prune_interval = 5
prune_amount = 0.5
==================================================

============= Running time: 0th =============
Creating server and clients ...
FedAvgCNN(
  (conv1): Sequential(
    (0): Conv2d(1, 32, kernel_size=(5, 5), stride=(1, 1))
    (1): ReLU(inplace=True)
    (2): MaxPool2d(kernel_size=(2, 2), stride=(2, 2), padding=0, dilation=1, ceil_mode=False)
  )
  (conv2): Sequential(
    (0): Conv2d(32, 64, kernel_size=(5, 5), stride=(1, 1))
    (1): ReLU(inplace=True)
    (2): MaxPool2d(kernel_size=(2, 2), stride=(2, 2), padding=0, dilation=1, ceil_mode=False)
  )
  (fc1): Sequential(
    (0): Linear(in_features=1024, out_features=512, bias=True)
    (1): ReLU(inplace=True)
  )
  (fc): Linear(in_features=512, out_features=10, bias=True)
)

Join ratio / total clients: 0.8 / 20
Finished creating server and clients.

-------------Round number: 0-------------

Evaluate global model
Averaged Train Loss: 2.3125
Averaged Test Accurancy: 0.0583
Averaged Test AUC: 0.4299
Std Test Accurancy: 0.0526
Std Test AUC: 0.1484
-------------------------------------------------- 7.521172523498535

-------------Round number: 1-------------

Evaluate global model
Averaged Train Loss: 2.5827
Averaged Test Accurancy: 0.1147
Averaged Test AUC: 0.5466
Std Test Accurancy: 0.2328
Std Test AUC: 0.2770
-------------------------------------------------- 6.976235866546631

-------------Round number: 2-------------

Evaluate global model
Averaged Train Loss: 2.8779
Averaged Test Accurancy: 0.2148
Averaged Test AUC: 0.5679
Std Test Accurancy: 0.3848
Std Test AUC: 0.3094
-------------------------------------------------- 6.415068864822388

-------------Round number: 3-------------

Evaluate global model
Averaged Train Loss: 3.0204
Averaged Test Accurancy: 0.2832
Averaged Test AUC: 0.6298
Std Test Accurancy: 0.3699
Std Test AUC: 0.3068
-------------------------------------------------- 7.938925266265869

-------------Round number: 4-------------

Evaluate global model
Averaged Train Loss: 3.0345
Averaged Test Accurancy: 0.2388
Averaged Test AUC: 0.6852
Std Test Accurancy: 0.3269
Std Test AUC: 0.2372
-------------------------------------------------- 7.904696702957153

-------------Round number: 5-------------

Evaluate global model
Averaged Train Loss: 2.6428
Averaged Test Accurancy: 0.4261
Averaged Test AUC: 0.8398
Std Test Accurancy: 0.3148
Std Test AUC: 0.1249
-------------------------------------------------- 7.776169300079346

-------------Round number: 6-------------

Evaluate global model
Averaged Train Loss: 2.5181
Averaged Test Accurancy: 0.4588
Averaged Test AUC: 0.8251
Std Test Accurancy: 0.3667
Std Test AUC: 0.1753
-------------------------------------------------- 7.846290111541748

-------------Round number: 7-------------

Evaluate global model
Averaged Train Loss: 2.2258
Averaged Test Accurancy: 0.5449
Averaged Test AUC: 0.8810
Std Test Accurancy: 0.2759
Std Test AUC: 0.1027
-------------------------------------------------- 7.193459987640381

-------------Round number: 8-------------

Evaluate global model
Averaged Train Loss: 1.8797
Averaged Test Accurancy: 0.6644
Averaged Test AUC: 0.9226
Std Test Accurancy: 0.1434
Std Test AUC: 0.0324
-------------------------------------------------- 7.879713296890259

-------------Round number: 9-------------

Evaluate global model
Averaged Train Loss: 1.7613
Averaged Test Accurancy: 0.6820
Averaged Test AUC: 0.9271
Std Test Accurancy: 0.1615
Std Test AUC: 0.0363
-------------------------------------------------- 7.307934761047363

-------------Round number: 10-------------

Evaluate global model
Averaged Train Loss: 1.8423
Averaged Test Accurancy: 0.6668
Averaged Test AUC: 0.9156
Std Test Accurancy: 0.2283
Std Test AUC: 0.0622
-------------------------------------------------- 7.231566905975342

-------------Round number: 11-------------

Evaluate global model
Averaged Train Loss: 1.6545
Averaged Test Accurancy: 0.7057
Averaged Test AUC: 0.9312
Std Test Accurancy: 0.1135
Std Test AUC: 0.0265
-------------------------------------------------- 6.233236074447632

-------------Round number: 12-------------

Evaluate global model
Averaged Train Loss: 1.6289
Averaged Test Accurancy: 0.7185
Averaged Test AUC: 0.9319
Std Test Accurancy: 0.1058
Std Test AUC: 0.0274
-------------------------------------------------- 7.26214075088501

-------------Round number: 13-------------

Evaluate global model
Averaged Train Loss: 1.6201
Averaged Test Accurancy: 0.7135
Averaged Test AUC: 0.9324
Std Test Accurancy: 0.1186
Std Test AUC: 0.0274
-------------------------------------------------- 7.140283584594727

-------------Round number: 14-------------

Evaluate global model
Averaged Train Loss: 1.5655
Averaged Test Accurancy: 0.7192
Averaged Test AUC: 0.9326
Std Test Accurancy: 0.1050
Std Test AUC: 0.0280
-------------------------------------------------- 7.096441030502319

-------------Round number: 15-------------

Evaluate global model
Averaged Train Loss: 1.5250
Averaged Test Accurancy: 0.7262
Averaged Test AUC: 0.9361
Std Test Accurancy: 0.0941
Std Test AUC: 0.0166
-------------------------------------------------- 7.096728086471558

-------------Round number: 16-------------

Evaluate global model
Averaged Train Loss: 1.4587
Averaged Test Accurancy: 0.7359
Averaged Test AUC: 0.9365
Std Test Accurancy: 0.0922
Std Test AUC: 0.0241
-------------------------------------------------- 7.799180030822754

-------------Round number: 17-------------

Evaluate global model
Averaged Train Loss: 1.3905
Averaged Test Accurancy: 0.7463
Averaged Test AUC: 0.9378
Std Test Accurancy: 0.0998
Std Test AUC: 0.0227
-------------------------------------------------- 7.881383657455444

-------------Round number: 18-------------

Evaluate global model
Averaged Train Loss: 1.4703
Averaged Test Accurancy: 0.7294
Averaged Test AUC: 0.9315
Std Test Accurancy: 0.1887
Std Test AUC: 0.0456
-------------------------------------------------- 7.7691330909729

-------------Round number: 19-------------

Evaluate global model
Averaged Train Loss: 1.3739
Averaged Test Accurancy: 0.7332
Averaged Test AUC: 0.9399
Std Test Accurancy: 0.0949
Std Test AUC: 0.0166
-------------------------------------------------- 7.5748536586761475

-------------Round number: 20-------------

Evaluate global model
Averaged Train Loss: 1.2880
Averaged Test Accurancy: 0.7514
Averaged Test AUC: 0.9386
Std Test Accurancy: 0.1389
Std Test AUC: 0.0270
-------------------------------------------------- 7.7138378620147705

-------------Round number: 21-------------

Evaluate global model
Averaged Train Loss: 1.2050
Averaged Test Accurancy: 0.7574
Averaged Test AUC: 0.9417
Std Test Accurancy: 0.0988
Std Test AUC: 0.0224
-------------------------------------------------- 8.007335424423218

-------------Round number: 22-------------

Evaluate global model
Averaged Train Loss: 1.1839
Averaged Test Accurancy: 0.7515
Averaged Test AUC: 0.9408
Std Test Accurancy: 0.1508
Std Test AUC: 0.0246
-------------------------------------------------- 7.73266863822937

-------------Round number: 23-------------

Evaluate global model
Averaged Train Loss: 1.0921
Averaged Test Accurancy: 0.7653
Averaged Test AUC: 0.9428
Std Test Accurancy: 0.0896
Std Test AUC: 0.0154
-------------------------------------------------- 7.051539659500122

-------------Round number: 24-------------

Evaluate global model
Averaged Train Loss: 1.0877
Averaged Test Accurancy: 0.7651
Averaged Test AUC: 0.9444
Std Test Accurancy: 0.1071
Std Test AUC: 0.0202
-------------------------------------------------- 6.622212648391724

-------------Round number: 25-------------

Evaluate global model
Averaged Train Loss: 0.9752
Averaged Test Accurancy: 0.7750
Averaged Test AUC: 0.9452
Std Test Accurancy: 0.0948
Std Test AUC: 0.0153
-------------------------------------------------- 7.105341911315918

-------------Round number: 26-------------

Evaluate global model
Averaged Train Loss: 0.9529
Averaged Test Accurancy: 0.7686
Averaged Test AUC: 0.9444
Std Test Accurancy: 0.0951
Std Test AUC: 0.0176
-------------------------------------------------- 7.80180811882019

-------------Round number: 27-------------

Evaluate global model
Averaged Train Loss: 0.8524
Averaged Test Accurancy: 0.7854
Averaged Test AUC: 0.9469
Std Test Accurancy: 0.0995
Std Test AUC: 0.0164
-------------------------------------------------- 8.024837017059326

-------------Round number: 28-------------

Evaluate global model
Averaged Train Loss: 0.7967
Averaged Test Accurancy: 0.7880
Averaged Test AUC: 0.9480
Std Test Accurancy: 0.1093
Std Test AUC: 0.0204
-------------------------------------------------- 7.485461235046387

-------------Round number: 29-------------

Evaluate global model
Averaged Train Loss: 0.7584
Averaged Test Accurancy: 0.8009
Averaged Test AUC: 0.9487
Std Test Accurancy: 0.0697
Std Test AUC: 0.0144
-------------------------------------------------- 8.011374235153198

-------------Round number: 30-------------

Evaluate global model
Averaged Train Loss: 0.7070
Averaged Test Accurancy: 0.8090
Averaged Test AUC: 0.9514
Std Test Accurancy: 0.0989
Std Test AUC: 0.0175
-------------------------------------------------- 7.224171161651611

-------------Round number: 31-------------

Evaluate global model
Averaged Train Loss: 0.9317
Averaged Test Accurancy: 0.7463
Averaged Test AUC: 0.9463
Std Test Accurancy: 0.2460
Std Test AUC: 0.0396
-------------------------------------------------- 6.816173791885376

-------------Round number: 32-------------

Evaluate global model
Averaged Train Loss: 0.6429
Averaged Test Accurancy: 0.8178
Averaged Test AUC: 0.9534
Std Test Accurancy: 0.0973
Std Test AUC: 0.0153
-------------------------------------------------- 7.518643140792847

-------------Round number: 33-------------

Evaluate global model
Averaged Train Loss: 0.6192
Averaged Test Accurancy: 0.8213
Averaged Test AUC: 0.9542
Std Test Accurancy: 0.0933
Std Test AUC: 0.0135
-------------------------------------------------- 7.227656841278076

-------------Round number: 34-------------

Evaluate global model
Averaged Train Loss: 0.5888
Averaged Test Accurancy: 0.8300
Averaged Test AUC: 0.9547
Std Test Accurancy: 0.0857
Std Test AUC: 0.0131
-------------------------------------------------- 7.663187026977539

-------------Round number: 35-------------

Evaluate global model
Averaged Train Loss: 0.6087
Averaged Test Accurancy: 0.8209
Averaged Test AUC: 0.9530
Std Test Accurancy: 0.0830
Std Test AUC: 0.0165
-------------------------------------------------- 7.341469049453735

-------------Round number: 36-------------

Evaluate global model
Averaged Train Loss: 0.6441
Averaged Test Accurancy: 0.8019
Averaged Test AUC: 0.9549
Std Test Accurancy: 0.1761
Std Test AUC: 0.0271
-------------------------------------------------- 7.045101642608643

-------------Round number: 37-------------

Evaluate global model
Averaged Train Loss: 0.5670
Averaged Test Accurancy: 0.8319
Averaged Test AUC: 0.9551
Std Test Accurancy: 0.0798
Std Test AUC: 0.0151
-------------------------------------------------- 6.7307727336883545

-------------Round number: 38-------------

Evaluate global model
Averaged Train Loss: 0.5570
Averaged Test Accurancy: 0.8253
Averaged Test AUC: 0.9570
Std Test Accurancy: 0.1316
Std Test AUC: 0.0203
-------------------------------------------------- 7.263256311416626

-------------Round number: 39-------------

Evaluate global model
Averaged Train Loss: 0.5406
Averaged Test Accurancy: 0.8364
Averaged Test AUC: 0.9556
Std Test Accurancy: 0.0702
Std Test AUC: 0.0148
-------------------------------------------------- 7.506990432739258

-------------Round number: 40-------------

Evaluate global model
Averaged Train Loss: 0.5184
Averaged Test Accurancy: 0.8439
Averaged Test AUC: 0.9572
Std Test Accurancy: 0.0490
Std Test AUC: 0.0082
-------------------------------------------------- 6.792940616607666

-------------Round number: 41-------------

Evaluate global model
Averaged Train Loss: 0.5438
Averaged Test Accurancy: 0.8284
Averaged Test AUC: 0.9582
Std Test Accurancy: 0.1181
Std Test AUC: 0.0204
-------------------------------------------------- 7.670927286148071

-------------Round number: 42-------------

Evaluate global model
Averaged Train Loss: 0.5702
Averaged Test Accurancy: 0.8153
Averaged Test AUC: 0.9569
Std Test Accurancy: 0.1308
Std Test AUC: 0.0195
-------------------------------------------------- 6.879528284072876

-------------Round number: 43-------------

Evaluate global model
Averaged Train Loss: 0.5270
Averaged Test Accurancy: 0.8344
Averaged Test AUC: 0.9578
Std Test Accurancy: 0.1238
Std Test AUC: 0.0162
-------------------------------------------------- 7.742892503738403

-------------Round number: 44-------------

Evaluate global model
Averaged Train Loss: 0.5173
Averaged Test Accurancy: 0.8419
Averaged Test AUC: 0.9608
Std Test Accurancy: 0.0733
Std Test AUC: 0.0156
-------------------------------------------------- 7.028596639633179

-------------Round number: 45-------------

Evaluate global model
Averaged Train Loss: 0.5007
Averaged Test Accurancy: 0.8490
Averaged Test AUC: 0.9635
Std Test Accurancy: 0.0780
Std Test AUC: 0.0143
-------------------------------------------------- 6.904904842376709

-------------Round number: 46-------------

Evaluate global model
Averaged Train Loss: 0.5171
Averaged Test Accurancy: 0.8326
Averaged Test AUC: 0.9595
Std Test Accurancy: 0.0792
Std Test AUC: 0.0141
-------------------------------------------------- 7.739842176437378

-------------Round number: 47-------------

Evaluate global model
Averaged Train Loss: 0.4661
Averaged Test Accurancy: 0.8625
Averaged Test AUC: 0.9650
Std Test Accurancy: 0.0729
Std Test AUC: 0.0156
-------------------------------------------------- 7.77176833152771

-------------Round number: 48-------------

Evaluate global model
Averaged Train Loss: 0.4666
Averaged Test Accurancy: 0.8655
Averaged Test AUC: 0.9658
Std Test Accurancy: 0.0681
Std Test AUC: 0.0158
-------------------------------------------------- 7.693379878997803

-------------Round number: 49-------------

Evaluate global model
Averaged Train Loss: 0.4641
Averaged Test Accurancy: 0.8704
Averaged Test AUC: 0.9671
Std Test Accurancy: 0.0537
Std Test AUC: 0.0084
-------------------------------------------------- 5.864991188049316

-------------Round number: 50-------------

Evaluate global model
Averaged Train Loss: 0.4776
Averaged Test Accurancy: 0.8607
Averaged Test AUC: 0.9685
Std Test Accurancy: 0.0888
Std Test AUC: 0.0171
-------------------------------------------------- 7.435114622116089

Best accuracy.
0.8703946992631518

Best local accuracy.

Averaged time per iteration.
7.3548433256149295
File path: ../results/MNIST_FedDyn_test_0.h5

Average time cost: 376.02s.
Length:  51
std for best accurancy: 0.0
mean for best accurancy: 0.8703946992631518
All done!

Storage on cuda:0
-------------------------------------------------------------------------------
Total Tensors: 59948678 	Used Memory: 184.36M
The allocated memory on cuda:0: 206.74M
Memory differs due to the matrix alignment or invisible gradient buffer tensors
-------------------------------------------------------------------------------

Total time cost: 376.09s.

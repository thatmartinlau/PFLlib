==================================================
goal = test
device = cuda
device_id = 0
dataset = MNIST
num_classes = 10
model = CNN
batch_size = 64
local_learning_rate = 0.001
learning_rate_decay = False
learning_rate_decay_gamma = 0.99
global_rounds = 50
top_cnt = 100
local_epochs = 5
algorithm = PFL-DA
join_ratio = 0.8
random_join_ratio = False
num_clients = 20
prev = 0
times = 1
eval_gap = 1
save_folder_name = items
auto_break = False
dlg_eval = False
dlg_gap = 100
batch_num_per_client = 2
num_new_clients = 0
fine_tuning_epoch_new = 0
feature_dim = 512
vocab_size = 32000
max_len = 200
client_drop_rate = 0.0
train_slow_rate = 0.0
send_slow_rate = 0.0
time_select = False
time_threthold = 10000
beta = 0.0
lamda = 1.0
mu = 0.0
K = 5
p_learning_rate = 0.01
M = 5
itk = 4000
alphaK = 1.0
sigma = 1.0
alpha = 1.0
plocal_epochs = 1
tau = 1.0
fine_tuning_epochs = 10
dr_learning_rate = 0.0
L = 1.0
noise_dim = 512
generator_learning_rate = 0.005
hidden_dim = 512
server_epochs = 1000
localize_feature_extractor = False
server_learning_rate = 1.0
eta = 1.0
rand_percent = 80
layer_idx = 2
mentee_learning_rate = 0.005
T_start = 0.95
T_end = 0.98
momentum = 0.1
kl_weight = 0.0
prune_interval = 5
prune_amount = 0.5
==================================================

============= Running time: 0th =============
Creating server and clients ...
FedAvgCNN(
  (conv1): Sequential(
    (0): Conv2d(1, 32, kernel_size=(5, 5), stride=(1, 1))
    (1): ReLU(inplace=True)
    (2): MaxPool2d(kernel_size=(2, 2), stride=(2, 2), padding=0, dilation=1, ceil_mode=False)
  )
  (conv2): Sequential(
    (0): Conv2d(32, 64, kernel_size=(5, 5), stride=(1, 1))
    (1): ReLU(inplace=True)
    (2): MaxPool2d(kernel_size=(2, 2), stride=(2, 2), padding=0, dilation=1, ceil_mode=False)
  )
  (fc1): Sequential(
    (0): Linear(in_features=1024, out_features=512, bias=True)
    (1): ReLU(inplace=True)
  )
  (fc): Linear(in_features=512, out_features=10, bias=True)
)

Join ratio / total clients: 0.8 / 20
Finished creating server and clients.

-------------Round number: 0-------------

Evaluate personalized models
Averaged Train Loss: 2.3125
Averaged Test Accurancy: 0.0583
Averaged Test AUC: 0.4299
Std Test Accurancy: 0.0526
Std Test AUC: 0.1484
------------------------- time cost ------------------------- 8.434005975723267

-------------Round number: 1-------------

Evaluate personalized models
Averaged Train Loss: 1.1987
Averaged Test Accurancy: 0.5444
Averaged Test AUC: 0.8528
Std Test Accurancy: 0.2799
Std Test AUC: 0.1864
------------------------- time cost ------------------------- 8.130930185317993

-------------Round number: 2-------------

Evaluate personalized models
Averaged Train Loss: 0.7464
Averaged Test Accurancy: 0.7120
Averaged Test AUC: 0.9337
Std Test Accurancy: 0.2112
Std Test AUC: 0.0910
------------------------- time cost ------------------------- 9.054712533950806

-------------Round number: 3-------------

Evaluate personalized models
Averaged Train Loss: 0.3523
Averaged Test Accurancy: 0.9078
Averaged Test AUC: 0.9904
Std Test Accurancy: 0.1437
Std Test AUC: 0.0111
------------------------- time cost ------------------------- 8.946782112121582

-------------Round number: 4-------------

Evaluate personalized models
Averaged Train Loss: 0.2810
Averaged Test Accurancy: 0.9256
Averaged Test AUC: 0.9924
Std Test Accurancy: 0.1332
Std Test AUC: 0.0106
------------------------- time cost ------------------------- 10.002914190292358

-------------Round number: 5-------------

Evaluate personalized models
Averaged Train Loss: 0.2047
Averaged Test Accurancy: 0.9444
Averaged Test AUC: 0.9948
Std Test Accurancy: 0.1145
Std Test AUC: 0.0102
------------------------- time cost ------------------------- 10.155455589294434

-------------Round number: 6-------------

Evaluate personalized models
Averaged Train Loss: 0.1697
Averaged Test Accurancy: 0.9525
Averaged Test AUC: 0.9958
Std Test Accurancy: 0.1112
Std Test AUC: 0.0099
------------------------- time cost ------------------------- 8.657147407531738

-------------Round number: 7-------------

Evaluate personalized models
Averaged Train Loss: 0.1475
Averaged Test Accurancy: 0.9596
Averaged Test AUC: 0.9967
Std Test Accurancy: 0.1041
Std Test AUC: 0.0086
------------------------- time cost ------------------------- 9.037420988082886

-------------Round number: 8-------------

Evaluate personalized models
Averaged Train Loss: 0.1294
Averaged Test Accurancy: 0.9616
Averaged Test AUC: 0.9972
Std Test Accurancy: 0.1028
Std Test AUC: 0.0079
------------------------- time cost ------------------------- 9.215500354766846

-------------Round number: 9-------------

Evaluate personalized models
Averaged Train Loss: 0.1133
Averaged Test Accurancy: 0.9721
Averaged Test AUC: 0.9978
Std Test Accurancy: 0.0776
Std Test AUC: 0.0066
------------------------- time cost ------------------------- 8.141189575195312

-------------Round number: 10-------------

Evaluate personalized models
Averaged Train Loss: 0.1003
Averaged Test Accurancy: 0.9750
Averaged Test AUC: 0.9983
Std Test Accurancy: 0.0615
Std Test AUC: 0.0055
------------------------- time cost ------------------------- 7.88487434387207

-------------Round number: 11-------------

Evaluate personalized models
Averaged Train Loss: 0.0901
Averaged Test Accurancy: 0.9785
Averaged Test AUC: 0.9986
Std Test Accurancy: 0.0489
Std Test AUC: 0.0049
------------------------- time cost ------------------------- 8.094894647598267

-------------Round number: 12-------------

Evaluate personalized models
Averaged Train Loss: 0.0801
Averaged Test Accurancy: 0.9802
Averaged Test AUC: 0.9989
Std Test Accurancy: 0.0424
Std Test AUC: 0.0040
------------------------- time cost ------------------------- 8.973319292068481

-------------Round number: 13-------------

Evaluate personalized models
Averaged Train Loss: 0.0741
Averaged Test Accurancy: 0.9826
Averaged Test AUC: 0.9990
Std Test Accurancy: 0.0312
Std Test AUC: 0.0036
------------------------- time cost ------------------------- 8.517912149429321

-------------Round number: 14-------------

Evaluate personalized models
Averaged Train Loss: 0.0679
Averaged Test Accurancy: 0.9842
Averaged Test AUC: 0.9991
Std Test Accurancy: 0.0260
Std Test AUC: 0.0032
------------------------- time cost ------------------------- 9.854107141494751

-------------Round number: 15-------------

Evaluate personalized models
Averaged Train Loss: 0.0622
Averaged Test Accurancy: 0.9855
Averaged Test AUC: 0.9993
Std Test Accurancy: 0.0228
Std Test AUC: 0.0025
------------------------- time cost ------------------------- 9.993930339813232

-------------Round number: 16-------------

Evaluate personalized models
Averaged Train Loss: 0.0587
Averaged Test Accurancy: 0.9854
Averaged Test AUC: 0.9994
Std Test Accurancy: 0.0210
Std Test AUC: 0.0023
------------------------- time cost ------------------------- 9.981273651123047

-------------Round number: 17-------------

Evaluate personalized models
Averaged Train Loss: 0.0543
Averaged Test Accurancy: 0.9859
Averaged Test AUC: 0.9994
Std Test Accurancy: 0.0211
Std Test AUC: 0.0020
------------------------- time cost ------------------------- 9.755463600158691

-------------Round number: 18-------------

Evaluate personalized models
Averaged Train Loss: 0.0502
Averaged Test Accurancy: 0.9872
Averaged Test AUC: 0.9995
Std Test Accurancy: 0.0191
Std Test AUC: 0.0016
------------------------- time cost ------------------------- 9.45760178565979

-------------Round number: 19-------------

Evaluate personalized models
Averaged Train Loss: 0.0473
Averaged Test Accurancy: 0.9877
Averaged Test AUC: 0.9996
Std Test Accurancy: 0.0190
Std Test AUC: 0.0014
------------------------- time cost ------------------------- 7.994239568710327

-------------Round number: 20-------------

Evaluate personalized models
Averaged Train Loss: 0.0441
Averaged Test Accurancy: 0.9877
Averaged Test AUC: 0.9996
Std Test Accurancy: 0.0183
Std Test AUC: 0.0013
------------------------- time cost ------------------------- 8.950201511383057

-------------Round number: 21-------------

Evaluate personalized models
Averaged Train Loss: 0.0421
Averaged Test Accurancy: 0.9883
Averaged Test AUC: 0.9997
Std Test Accurancy: 0.0173
Std Test AUC: 0.0012
------------------------- time cost ------------------------- 8.754229545593262

-------------Round number: 22-------------

Evaluate personalized models
Averaged Train Loss: 0.0403
Averaged Test Accurancy: 0.9883
Averaged Test AUC: 0.9997
Std Test Accurancy: 0.0173
Std Test AUC: 0.0011
------------------------- time cost ------------------------- 9.908191442489624

-------------Round number: 23-------------

Evaluate personalized models
Averaged Train Loss: 0.0384
Averaged Test Accurancy: 0.9887
Averaged Test AUC: 0.9997
Std Test Accurancy: 0.0177
Std Test AUC: 0.0010
------------------------- time cost ------------------------- 9.105921268463135

-------------Round number: 24-------------

Evaluate personalized models
Averaged Train Loss: 0.0364
Averaged Test Accurancy: 0.9887
Averaged Test AUC: 0.9997
Std Test Accurancy: 0.0168
Std Test AUC: 0.0009
------------------------- time cost ------------------------- 8.674058675765991

-------------Round number: 25-------------

Evaluate personalized models
Averaged Train Loss: 0.0347
Averaged Test Accurancy: 0.9891
Averaged Test AUC: 0.9997
Std Test Accurancy: 0.0174
Std Test AUC: 0.0008
------------------------- time cost ------------------------- 9.069870233535767

-------------Round number: 26-------------

Evaluate personalized models
Averaged Train Loss: 0.0336
Averaged Test Accurancy: 0.9894
Averaged Test AUC: 0.9998
Std Test Accurancy: 0.0172
Std Test AUC: 0.0008
------------------------- time cost ------------------------- 9.724050283432007

-------------Round number: 27-------------

Evaluate personalized models
Averaged Train Loss: 0.0322
Averaged Test Accurancy: 0.9898
Averaged Test AUC: 0.9998
Std Test Accurancy: 0.0156
Std Test AUC: 0.0007
------------------------- time cost ------------------------- 10.061347723007202

-------------Round number: 28-------------

Evaluate personalized models
Averaged Train Loss: 0.0310
Averaged Test Accurancy: 0.9902
Averaged Test AUC: 0.9998
Std Test Accurancy: 0.0148
Std Test AUC: 0.0007
------------------------- time cost ------------------------- 9.218966484069824

-------------Round number: 29-------------

Evaluate personalized models
Averaged Train Loss: 0.0300
Averaged Test Accurancy: 0.9902
Averaged Test AUC: 0.9998
Std Test Accurancy: 0.0150
Std Test AUC: 0.0007
------------------------- time cost ------------------------- 10.000683784484863

-------------Round number: 30-------------

Evaluate personalized models
Averaged Train Loss: 0.0292
Averaged Test Accurancy: 0.9905
Averaged Test AUC: 0.9998
Std Test Accurancy: 0.0146
Std Test AUC: 0.0006
------------------------- time cost ------------------------- 8.994488716125488

-------------Round number: 31-------------

Evaluate personalized models
Averaged Train Loss: 0.0282
Averaged Test Accurancy: 0.9904
Averaged Test AUC: 0.9998
Std Test Accurancy: 0.0151
Std Test AUC: 0.0006
------------------------- time cost ------------------------- 9.993402481079102

-------------Round number: 32-------------

Evaluate personalized models
Averaged Train Loss: 0.0273
Averaged Test Accurancy: 0.9907
Averaged Test AUC: 0.9998
Std Test Accurancy: 0.0155
Std Test AUC: 0.0006
------------------------- time cost ------------------------- 8.073007106781006

-------------Round number: 33-------------

Evaluate personalized models
Averaged Train Loss: 0.0264
Averaged Test Accurancy: 0.9911
Averaged Test AUC: 0.9998
Std Test Accurancy: 0.0140
Std Test AUC: 0.0006
------------------------- time cost ------------------------- 10.082268714904785

-------------Round number: 34-------------

Evaluate personalized models
Averaged Train Loss: 0.0258
Averaged Test Accurancy: 0.9912
Averaged Test AUC: 0.9998
Std Test Accurancy: 0.0137
Std Test AUC: 0.0005
------------------------- time cost ------------------------- 9.972920179367065

-------------Round number: 35-------------

Evaluate personalized models
Averaged Train Loss: 0.0251
Averaged Test Accurancy: 0.9914
Averaged Test AUC: 0.9998
Std Test Accurancy: 0.0138
Std Test AUC: 0.0005
------------------------- time cost ------------------------- 9.630296468734741

-------------Round number: 36-------------

Evaluate personalized models
Averaged Train Loss: 0.0247
Averaged Test Accurancy: 0.9915
Averaged Test AUC: 0.9999
Std Test Accurancy: 0.0134
Std Test AUC: 0.0005
------------------------- time cost ------------------------- 9.976596117019653

-------------Round number: 37-------------

Evaluate personalized models
Averaged Train Loss: 0.0240
Averaged Test Accurancy: 0.9915
Averaged Test AUC: 0.9999
Std Test Accurancy: 0.0135
Std Test AUC: 0.0005
------------------------- time cost ------------------------- 9.049978017807007

-------------Round number: 38-------------

Evaluate personalized models
Averaged Train Loss: 0.0235
Averaged Test Accurancy: 0.9917
Averaged Test AUC: 0.9999
Std Test Accurancy: 0.0136
Std Test AUC: 0.0005
------------------------- time cost ------------------------- 9.555992603302002

-------------Round number: 39-------------

Evaluate personalized models
Averaged Train Loss: 0.0228
Averaged Test Accurancy: 0.9917
Averaged Test AUC: 0.9999
Std Test Accurancy: 0.0136
Std Test AUC: 0.0005
------------------------- time cost ------------------------- 8.901854753494263

-------------Round number: 40-------------

Evaluate personalized models
Averaged Train Loss: 0.0224
Averaged Test Accurancy: 0.9919
Averaged Test AUC: 0.9999
Std Test Accurancy: 0.0135
Std Test AUC: 0.0004
------------------------- time cost ------------------------- 7.079977512359619

-------------Round number: 41-------------

Evaluate personalized models
Averaged Train Loss: 0.0221
Averaged Test Accurancy: 0.9921
Averaged Test AUC: 0.9999
Std Test Accurancy: 0.0128
Std Test AUC: 0.0004
------------------------- time cost ------------------------- 9.94529128074646

-------------Round number: 42-------------

Evaluate personalized models
Averaged Train Loss: 0.0216
Averaged Test Accurancy: 0.9923
Averaged Test AUC: 0.9999
Std Test Accurancy: 0.0125
Std Test AUC: 0.0004
------------------------- time cost ------------------------- 8.27953839302063

-------------Round number: 43-------------

Evaluate personalized models
Averaged Train Loss: 0.0211
Averaged Test Accurancy: 0.9923
Averaged Test AUC: 0.9999
Std Test Accurancy: 0.0127
Std Test AUC: 0.0004
------------------------- time cost ------------------------- 9.029477596282959

-------------Round number: 44-------------

Evaluate personalized models
Averaged Train Loss: 0.0206
Averaged Test Accurancy: 0.9923
Averaged Test AUC: 0.9999
Std Test Accurancy: 0.0133
Std Test AUC: 0.0004
------------------------- time cost ------------------------- 8.913223505020142

-------------Round number: 45-------------

Evaluate personalized models
Averaged Train Loss: 0.0201
Averaged Test Accurancy: 0.9924
Averaged Test AUC: 0.9999
Std Test Accurancy: 0.0131
Std Test AUC: 0.0004
------------------------- time cost ------------------------- 8.993290901184082

-------------Round number: 46-------------

Evaluate personalized models
Averaged Train Loss: 0.0199
Averaged Test Accurancy: 0.9924
Averaged Test AUC: 0.9999
Std Test Accurancy: 0.0129
Std Test AUC: 0.0004
------------------------- time cost ------------------------- 8.087275743484497

-------------Round number: 47-------------

Evaluate personalized models
Averaged Train Loss: 0.0195
Averaged Test Accurancy: 0.9929
Averaged Test AUC: 0.9999
Std Test Accurancy: 0.0118
Std Test AUC: 0.0004
------------------------- time cost ------------------------- 9.524369478225708

-------------Round number: 48-------------

Evaluate personalized models
Averaged Train Loss: 0.0190
Averaged Test Accurancy: 0.9929
Averaged Test AUC: 0.9999
Std Test Accurancy: 0.0115
Std Test AUC: 0.0004
------------------------- time cost ------------------------- 9.973339319229126

-------------Round number: 49-------------

Evaluate personalized models
Averaged Train Loss: 0.0187
Averaged Test Accurancy: 0.9929
Averaged Test AUC: 0.9999
Std Test Accurancy: 0.0115
Std Test AUC: 0.0004
------------------------- time cost ------------------------- 7.8741185665130615

-------------Round number: 50-------------

Evaluate personalized models
Averaged Train Loss: 0.0184
Averaged Test Accurancy: 0.9929
Averaged Test AUC: 0.9999
Std Test Accurancy: 0.0119
Std Test AUC: 0.0004
------------------------- time cost ------------------------- 9.826746940612793

Best accuracy.
0.9929171188667391

Average time cost per round.
9.141492896080017
File path: ../results/MNIST_PFL-DA_test_0.h5

Average time cost: 466.23s.
Length:  51
std for best accurancy: 0.0
mean for best accurancy: 0.9929171188667391
All done!

Storage on cuda:0
-------------------------------------------------------------------------------
Total Tensors: 35611316 	Used Memory: 91.51M
The allocated memory on cuda:0: 109.01M
Memory differs due to the matrix alignment or invisible gradient buffer tensors
-------------------------------------------------------------------------------

Total time cost: 466.3s.

==================================================
goal = test
device = cuda
device_id = 0
dataset = MNIST
num_classes = 10
model = CNN
batch_size = 64
local_learning_rate = 0.01
learning_rate_decay = False
learning_rate_decay_gamma = 0.99
global_rounds = 50
top_cnt = 100
local_epochs = 1
algorithm = MOONThread
join_ratio = 0.8
random_join_ratio = False
num_clients = 20
prev = 0
times = 1
eval_gap = 1
save_folder_name = items
auto_break = False
dlg_eval = False
dlg_gap = 100
batch_num_per_client = 2
num_new_clients = 0
fine_tuning_epoch_new = 0
feature_dim = 512
vocab_size = 32000
max_len = 200
client_drop_rate = 0.0
train_slow_rate = 0.0
send_slow_rate = 0.0
time_select = False
time_threthold = 10000
beta = 0.0
lamda = 1.0
mu = 0.0
K = 5
p_learning_rate = 0.01
M = 5
itk = 4000
alphaK = 1.0
sigma = 1.0
alpha = 1.0
plocal_epochs = 1
tau = 1.0
fine_tuning_epochs = 10
dr_learning_rate = 0.0
L = 1.0
noise_dim = 512
generator_learning_rate = 0.005
hidden_dim = 512
server_epochs = 1000
localize_feature_extractor = False
server_learning_rate = 1.0
eta = 1.0
rand_percent = 80
layer_idx = 2
mentee_learning_rate = 0.005
T_start = 0.95
T_end = 0.98
momentum = 0.1
kl_weight = 0.0
prune_interval = 5
prune_amount = 0.5
==================================================

============= Running time: 0th =============
Creating server and clients ...
FedAvgCNN(
  (conv1): Sequential(
    (0): Conv2d(1, 32, kernel_size=(5, 5), stride=(1, 1))
    (1): ReLU(inplace=True)
    (2): MaxPool2d(kernel_size=(2, 2), stride=(2, 2), padding=0, dilation=1, ceil_mode=False)
  )
  (conv2): Sequential(
    (0): Conv2d(32, 64, kernel_size=(5, 5), stride=(1, 1))
    (1): ReLU(inplace=True)
    (2): MaxPool2d(kernel_size=(2, 2), stride=(2, 2), padding=0, dilation=1, ceil_mode=False)
  )
  (fc1): Sequential(
    (0): Linear(in_features=1024, out_features=512, bias=True)
    (1): ReLU(inplace=True)
  )
  (fc): Linear(in_features=512, out_features=10, bias=True)
)

Join ratio / total clients: 0.8 / 20
Finished creating server and clients.

-------------Round number: 0-------------

Evaluate global model
Averaged Train Loss: 2.3125
Averaged Test Accurancy: 0.0583
Averaged Test AUC: 0.4299
Std Test Accurancy: 0.0526
Std Test AUC: 0.1484
-------------------------------------------------- 3.936370372772217

-------------Round number: 1-------------

Evaluate global model
Averaged Train Loss: 2.2641
Averaged Test Accurancy: 0.2449
Averaged Test AUC: 0.5879
Std Test Accurancy: 0.2846
Std Test AUC: 0.3419
-------------------------------------------------- 3.727567434310913

-------------Round number: 2-------------

Evaluate global model
Averaged Train Loss: 2.1399
Averaged Test Accurancy: 0.3771
Averaged Test AUC: 0.6442
Std Test Accurancy: 0.4085
Std Test AUC: 0.3501
-------------------------------------------------- 3.729999542236328

-------------Round number: 3-------------

Evaluate global model
Averaged Train Loss: 1.9811
Averaged Test Accurancy: 0.4450
Averaged Test AUC: 0.7059
Std Test Accurancy: 0.4123
Std Test AUC: 0.3263
-------------------------------------------------- 3.9334957599639893

-------------Round number: 4-------------

Evaluate global model
Averaged Train Loss: 1.7168
Averaged Test Accurancy: 0.5419
Averaged Test AUC: 0.8930
Std Test Accurancy: 0.3373
Std Test AUC: 0.0874
-------------------------------------------------- 3.9926462173461914

-------------Round number: 5-------------

Evaluate global model
Averaged Train Loss: 1.5262
Averaged Test Accurancy: 0.6500
Averaged Test AUC: 0.9165
Std Test Accurancy: 0.2700
Std Test AUC: 0.0747
-------------------------------------------------- 3.911541700363159

-------------Round number: 6-------------

Evaluate global model
Averaged Train Loss: 1.3827
Averaged Test Accurancy: 0.6790
Averaged Test AUC: 0.9318
Std Test Accurancy: 0.1541
Std Test AUC: 0.0334
-------------------------------------------------- 3.924445390701294

-------------Round number: 7-------------

Evaluate global model
Averaged Train Loss: 1.2547
Averaged Test Accurancy: 0.7080
Averaged Test AUC: 0.9354
Std Test Accurancy: 0.1455
Std Test AUC: 0.0358
-------------------------------------------------- 3.8784255981445312

-------------Round number: 8-------------

Evaluate global model
Averaged Train Loss: 1.1641
Averaged Test Accurancy: 0.7028
Averaged Test AUC: 0.9343
Std Test Accurancy: 0.1826
Std Test AUC: 0.0440
-------------------------------------------------- 3.4658217430114746

-------------Round number: 9-------------

Evaluate global model
Averaged Train Loss: 1.2195
Averaged Test Accurancy: 0.5918
Averaged Test AUC: 0.8965
Std Test Accurancy: 0.3660
Std Test AUC: 0.1045
-------------------------------------------------- 3.6264517307281494

-------------Round number: 10-------------

Evaluate global model
Averaged Train Loss: 1.1104
Averaged Test Accurancy: 0.6712
Averaged Test AUC: 0.9120
Std Test Accurancy: 0.3176
Std Test AUC: 0.1097
-------------------------------------------------- 3.979135513305664

-------------Round number: 11-------------

Evaluate global model
Averaged Train Loss: 0.9785
Averaged Test Accurancy: 0.7424
Averaged Test AUC: 0.9420
Std Test Accurancy: 0.1497
Std Test AUC: 0.0341
-------------------------------------------------- 3.7189993858337402

-------------Round number: 12-------------

Evaluate global model
Averaged Train Loss: 0.9943
Averaged Test Accurancy: 0.7136
Averaged Test AUC: 0.9384
Std Test Accurancy: 0.1533
Std Test AUC: 0.0289
-------------------------------------------------- 3.4579780101776123

-------------Round number: 13-------------

Evaluate global model
Averaged Train Loss: 1.0374
Averaged Test Accurancy: 0.6489
Averaged Test AUC: 0.9266
Std Test Accurancy: 0.2129
Std Test AUC: 0.0493
-------------------------------------------------- 3.730151653289795

-------------Round number: 14-------------

Evaluate global model
Averaged Train Loss: 0.9318
Averaged Test Accurancy: 0.7145
Averaged Test AUC: 0.9421
Std Test Accurancy: 0.1092
Std Test AUC: 0.0225
-------------------------------------------------- 3.702694892883301

-------------Round number: 15-------------

Evaluate global model
Averaged Train Loss: 0.9359
Averaged Test Accurancy: 0.7146
Averaged Test AUC: 0.9391
Std Test Accurancy: 0.0663
Std Test AUC: 0.0167
-------------------------------------------------- 3.400059223175049

-------------Round number: 16-------------

Evaluate global model
Averaged Train Loss: 0.9793
Averaged Test Accurancy: 0.6565
Averaged Test AUC: 0.9233
Std Test Accurancy: 0.3202
Std Test AUC: 0.0738
-------------------------------------------------- 3.9752538204193115

-------------Round number: 17-------------

Evaluate global model
Averaged Train Loss: 0.8187
Averaged Test Accurancy: 0.7552
Averaged Test AUC: 0.9465
Std Test Accurancy: 0.1517
Std Test AUC: 0.0315
-------------------------------------------------- 3.8457722663879395

-------------Round number: 18-------------

Evaluate global model
Averaged Train Loss: 0.7755
Averaged Test Accurancy: 0.7743
Averaged Test AUC: 0.9497
Std Test Accurancy: 0.1152
Std Test AUC: 0.0258
-------------------------------------------------- 3.693857431411743

-------------Round number: 19-------------

Evaluate global model
Averaged Train Loss: 0.7937
Averaged Test Accurancy: 0.7654
Averaged Test AUC: 0.9492
Std Test Accurancy: 0.0642
Std Test AUC: 0.0149
-------------------------------------------------- 3.5648157596588135

-------------Round number: 20-------------

Evaluate global model
Averaged Train Loss: 0.8948
Averaged Test Accurancy: 0.6956
Averaged Test AUC: 0.9336
Std Test Accurancy: 0.2495
Std Test AUC: 0.0569
-------------------------------------------------- 3.486619710922241

-------------Round number: 21-------------

Evaluate global model
Averaged Train Loss: 0.8699
Averaged Test Accurancy: 0.7163
Averaged Test AUC: 0.9400
Std Test Accurancy: 0.1821
Std Test AUC: 0.0470
-------------------------------------------------- 3.77726674079895

-------------Round number: 22-------------

Evaluate global model
Averaged Train Loss: 0.7589
Averaged Test Accurancy: 0.7554
Averaged Test AUC: 0.9457
Std Test Accurancy: 0.1915
Std Test AUC: 0.0410
-------------------------------------------------- 3.6586272716522217

-------------Round number: 23-------------

Evaluate global model
Averaged Train Loss: 0.7152
Averaged Test Accurancy: 0.7877
Averaged Test AUC: 0.9541
Std Test Accurancy: 0.0716
Std Test AUC: 0.0162
-------------------------------------------------- 3.666256904602051

-------------Round number: 24-------------

Evaluate global model
Averaged Train Loss: 0.7593
Averaged Test Accurancy: 0.7586
Averaged Test AUC: 0.9481
Std Test Accurancy: 0.1123
Std Test AUC: 0.0247
-------------------------------------------------- 3.6255874633789062

-------------Round number: 25-------------

Evaluate global model
Averaged Train Loss: 0.7284
Averaged Test Accurancy: 0.7604
Averaged Test AUC: 0.9512
Std Test Accurancy: 0.1818
Std Test AUC: 0.0353
-------------------------------------------------- 3.667905330657959

-------------Round number: 26-------------

Evaluate global model
Averaged Train Loss: 0.7221
Averaged Test Accurancy: 0.7607
Averaged Test AUC: 0.9489
Std Test Accurancy: 0.2123
Std Test AUC: 0.0440
-------------------------------------------------- 3.714484453201294

-------------Round number: 27-------------

Evaluate global model
Averaged Train Loss: 0.7509
Averaged Test Accurancy: 0.7438
Averaged Test AUC: 0.9433
Std Test Accurancy: 0.2753
Std Test AUC: 0.0654
-------------------------------------------------- 3.89741587638855

-------------Round number: 28-------------

Evaluate global model
Averaged Train Loss: 0.6492
Averaged Test Accurancy: 0.7982
Averaged Test AUC: 0.9574
Std Test Accurancy: 0.1253
Std Test AUC: 0.0239
-------------------------------------------------- 3.899610996246338

-------------Round number: 29-------------

Evaluate global model
Averaged Train Loss: 0.6238
Averaged Test Accurancy: 0.8124
Averaged Test AUC: 0.9595
Std Test Accurancy: 0.1013
Std Test AUC: 0.0219
-------------------------------------------------- 3.7231054306030273

-------------Round number: 30-------------

Evaluate global model
Averaged Train Loss: 0.6258
Averaged Test Accurancy: 0.8054
Averaged Test AUC: 0.9597
Std Test Accurancy: 0.0687
Std Test AUC: 0.0160
-------------------------------------------------- 3.5444910526275635

-------------Round number: 31-------------

Evaluate global model
Averaged Train Loss: 0.6914
Averaged Test Accurancy: 0.7692
Averaged Test AUC: 0.9552
Std Test Accurancy: 0.1025
Std Test AUC: 0.0200
-------------------------------------------------- 3.6392343044281006

-------------Round number: 32-------------

Evaluate global model
Averaged Train Loss: 0.6508
Averaged Test Accurancy: 0.7893
Averaged Test AUC: 0.9570
Std Test Accurancy: 0.1191
Std Test AUC: 0.0243
-------------------------------------------------- 3.871537208557129

-------------Round number: 33-------------

Evaluate global model
Averaged Train Loss: 0.5875
Averaged Test Accurancy: 0.8228
Averaged Test AUC: 0.9631
Std Test Accurancy: 0.0677
Std Test AUC: 0.0137
-------------------------------------------------- 3.8233349323272705

-------------Round number: 34-------------

Evaluate global model
Averaged Train Loss: 0.5916
Averaged Test Accurancy: 0.8107
Averaged Test AUC: 0.9623
Std Test Accurancy: 0.0962
Std Test AUC: 0.0162
-------------------------------------------------- 3.859203815460205

-------------Round number: 35-------------

Evaluate global model
Averaged Train Loss: 0.5788
Averaged Test Accurancy: 0.8233
Averaged Test AUC: 0.9619
Std Test Accurancy: 0.0987
Std Test AUC: 0.0222
-------------------------------------------------- 3.876807928085327

-------------Round number: 36-------------

Evaluate global model
Averaged Train Loss: 0.5754
Averaged Test Accurancy: 0.8215
Averaged Test AUC: 0.9628
Std Test Accurancy: 0.1062
Std Test AUC: 0.0214
-------------------------------------------------- 3.8948960304260254

-------------Round number: 37-------------

Evaluate global model
Averaged Train Loss: 0.5665
Averaged Test Accurancy: 0.8168
Averaged Test AUC: 0.9636
Std Test Accurancy: 0.1543
Std Test AUC: 0.0277
-------------------------------------------------- 3.7406811714172363

-------------Round number: 38-------------

Evaluate global model
Averaged Train Loss: 0.6292
Averaged Test Accurancy: 0.7819
Averaged Test AUC: 0.9575
Std Test Accurancy: 0.2054
Std Test AUC: 0.0388
-------------------------------------------------- 3.758495807647705

-------------Round number: 39-------------

Evaluate global model
Averaged Train Loss: 0.5410
Averaged Test Accurancy: 0.8346
Averaged Test AUC: 0.9663
Std Test Accurancy: 0.0894
Std Test AUC: 0.0177
-------------------------------------------------- 3.6941511631011963

-------------Round number: 40-------------

Evaluate global model
Averaged Train Loss: 0.5325
Averaged Test Accurancy: 0.8372
Averaged Test AUC: 0.9667
Std Test Accurancy: 0.0647
Std Test AUC: 0.0120
-------------------------------------------------- 3.9188549518585205

-------------Round number: 41-------------

Evaluate global model
Averaged Train Loss: 0.5195
Averaged Test Accurancy: 0.8431
Averaged Test AUC: 0.9667
Std Test Accurancy: 0.0830
Std Test AUC: 0.0175
-------------------------------------------------- 3.386693239212036

-------------Round number: 42-------------

Evaluate global model
Averaged Train Loss: 0.6117
Averaged Test Accurancy: 0.7792
Averaged Test AUC: 0.9586
Std Test Accurancy: 0.2210
Std Test AUC: 0.0380
-------------------------------------------------- 3.8234615325927734

-------------Round number: 43-------------

Evaluate global model
Averaged Train Loss: 0.5330
Averaged Test Accurancy: 0.8304
Averaged Test AUC: 0.9661
Std Test Accurancy: 0.1088
Std Test AUC: 0.0206
-------------------------------------------------- 3.570810079574585

-------------Round number: 44-------------

Evaluate global model
Averaged Train Loss: 0.5169
Averaged Test Accurancy: 0.8408
Averaged Test AUC: 0.9680
Std Test Accurancy: 0.0740
Std Test AUC: 0.0145
-------------------------------------------------- 3.8465323448181152

-------------Round number: 45-------------

Evaluate global model
Averaged Train Loss: 0.4971
Averaged Test Accurancy: 0.8500
Averaged Test AUC: 0.9689
Std Test Accurancy: 0.0735
Std Test AUC: 0.0157
-------------------------------------------------- 3.8982503414154053

-------------Round number: 46-------------

Evaluate global model
Averaged Train Loss: 0.5034
Averaged Test Accurancy: 0.8464
Averaged Test AUC: 0.9682
Std Test Accurancy: 0.0890
Std Test AUC: 0.0180
-------------------------------------------------- 3.8746583461761475

-------------Round number: 47-------------

Evaluate global model
Averaged Train Loss: 0.4963
Averaged Test Accurancy: 0.8437
Averaged Test AUC: 0.9682
Std Test Accurancy: 0.1203
Std Test AUC: 0.0232
-------------------------------------------------- 3.7106895446777344

-------------Round number: 48-------------

Evaluate global model
Averaged Train Loss: 0.4977
Averaged Test Accurancy: 0.8467
Averaged Test AUC: 0.9684
Std Test Accurancy: 0.0568
Std Test AUC: 0.0096
-------------------------------------------------- 3.631211280822754

-------------Round number: 49-------------

Evaluate global model
Averaged Train Loss: 0.5108
Averaged Test Accurancy: 0.8394
Averaged Test AUC: 0.9687
Std Test Accurancy: 0.0772
Std Test AUC: 0.0154
-------------------------------------------------- 3.7523317337036133

-------------Round number: 50-------------

Evaluate global model
Averaged Train Loss: 0.5157
Averaged Test Accurancy: 0.8300
Averaged Test AUC: 0.9667
Std Test Accurancy: 0.1336
Std Test AUC: 0.0260
-------------------------------------------------- 3.6151537895202637

Best accuracy.
0.850002856000457

Best local accuracy.

Averaged time per iteration.
3.7421494770050048
File path: ../results/MNIST_MOONThread_test_0.h5

Average time cost: 191.8s.
Length:  51
std for best accurancy: 0.0
mean for best accurancy: 0.850002856000457
All done!

Storage on cuda:0
-------------------------------------------------------------------------------
Total Tensors: 48308158 	Used Memory: 139.97M
The allocated memory on cuda:0: 294.00M
Memory differs due to the matrix alignment or invisible gradient buffer tensors
-------------------------------------------------------------------------------

Total time cost: 191.88s.

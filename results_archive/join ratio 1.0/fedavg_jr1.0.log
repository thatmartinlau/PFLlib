==================================================
goal = test
device = cuda
device_id = 0
dataset = MNIST
num_classes = 10
model = CNN
batch_size = 64
local_learning_rate = 0.01
learning_rate_decay = False
learning_rate_decay_gamma = 0.99
global_rounds = 50
top_cnt = 100
local_epochs = 5
algorithm = FedAvg
join_ratio = 1.0
random_join_ratio = False
num_clients = 20
prev = 0
times = 1
eval_gap = 1
save_folder_name = items
auto_break = False
dlg_eval = False
dlg_gap = 100
batch_num_per_client = 2
num_new_clients = 0
fine_tuning_epoch_new = 0
feature_dim = 512
vocab_size = 32000
max_len = 200
client_drop_rate = 0.0
train_slow_rate = 0.0
send_slow_rate = 0.0
time_select = False
time_threthold = 10000
beta = 0.0
lamda = 1.0
mu = 0.0
K = 5
p_learning_rate = 0.01
M = 5
itk = 4000
alphaK = 1.0
sigma = 1.0
alpha = 1.0
plocal_epochs = 1
tau = 1.0
fine_tuning_epochs = 10
dr_learning_rate = 0.0
L = 1.0
noise_dim = 512
generator_learning_rate = 0.005
hidden_dim = 512
server_epochs = 1000
localize_feature_extractor = False
server_learning_rate = 1.0
eta = 1.0
rand_percent = 80
layer_idx = 2
mentee_learning_rate = 0.005
T_start = 0.95
T_end = 0.98
momentum = 0.1
kl_weight = 0.0
prune_interval = 5
prune_amount = 0.5
==================================================

============= Running time: 0th =============
Creating server and clients ...
FedAvgCNN(
  (conv1): Sequential(
    (0): Conv2d(1, 32, kernel_size=(5, 5), stride=(1, 1))
    (1): ReLU(inplace=True)
    (2): MaxPool2d(kernel_size=(2, 2), stride=(2, 2), padding=0, dilation=1, ceil_mode=False)
  )
  (conv2): Sequential(
    (0): Conv2d(32, 64, kernel_size=(5, 5), stride=(1, 1))
    (1): ReLU(inplace=True)
    (2): MaxPool2d(kernel_size=(2, 2), stride=(2, 2), padding=0, dilation=1, ceil_mode=False)
  )
  (fc1): Sequential(
    (0): Linear(in_features=1024, out_features=512, bias=True)
    (1): ReLU(inplace=True)
  )
  (fc): Linear(in_features=512, out_features=10, bias=True)
)

Join ratio / total clients: 1.0 / 20
Finished creating server and clients.

-------------Round number: 0-------------

Evaluate global model
Averaged Train Loss: 2.3125
Averaged Test Accurancy: 0.0583
Averaged Test AUC: 0.4299
Std Test Accurancy: 0.0526
Std Test AUC: 0.1484
------------------------- time cost ------------------------- 7.202224016189575

-------------Round number: 1-------------

Evaluate global model
Averaged Train Loss: 2.1333
Averaged Test Accurancy: 0.2915
Averaged Test AUC: 0.7638
Std Test Accurancy: 0.2750
Std Test AUC: 0.1139
------------------------- time cost ------------------------- 7.006150484085083

-------------Round number: 2-------------

Evaluate global model
Averaged Train Loss: 1.7643
Averaged Test Accurancy: 0.6738
Averaged Test AUC: 0.9296
Std Test Accurancy: 0.1453
Std Test AUC: 0.0386
------------------------- time cost ------------------------- 6.982189655303955

-------------Round number: 3-------------

Evaluate global model
Averaged Train Loss: 1.4480
Averaged Test Accurancy: 0.7123
Averaged Test AUC: 0.9404
Std Test Accurancy: 0.1130
Std Test AUC: 0.0255
------------------------- time cost ------------------------- 7.050632953643799

-------------Round number: 4-------------

Evaluate global model
Averaged Train Loss: 1.2201
Averaged Test Accurancy: 0.7291
Averaged Test AUC: 0.9433
Std Test Accurancy: 0.1070
Std Test AUC: 0.0250
------------------------- time cost ------------------------- 6.9808220863342285

-------------Round number: 5-------------

Evaluate global model
Averaged Train Loss: 1.0627
Averaged Test Accurancy: 0.7417
Averaged Test AUC: 0.9460
Std Test Accurancy: 0.1046
Std Test AUC: 0.0235
------------------------- time cost ------------------------- 7.085691452026367

-------------Round number: 6-------------

Evaluate global model
Averaged Train Loss: 0.9495
Averaged Test Accurancy: 0.7539
Averaged Test AUC: 0.9481
Std Test Accurancy: 0.1053
Std Test AUC: 0.0246
------------------------- time cost ------------------------- 7.109406471252441

-------------Round number: 7-------------

Evaluate global model
Averaged Train Loss: 0.8718
Averaged Test Accurancy: 0.7663
Averaged Test AUC: 0.9509
Std Test Accurancy: 0.1004
Std Test AUC: 0.0227
------------------------- time cost ------------------------- 7.0278284549713135

-------------Round number: 8-------------

Evaluate global model
Averaged Train Loss: 0.8082
Averaged Test Accurancy: 0.7762
Averaged Test AUC: 0.9526
Std Test Accurancy: 0.1005
Std Test AUC: 0.0237
------------------------- time cost ------------------------- 7.1498799324035645

-------------Round number: 9-------------

Evaluate global model
Averaged Train Loss: 0.7619
Averaged Test Accurancy: 0.7828
Averaged Test AUC: 0.9543
Std Test Accurancy: 0.0986
Std Test AUC: 0.0238
------------------------- time cost ------------------------- 7.145568609237671

-------------Round number: 10-------------

Evaluate global model
Averaged Train Loss: 0.7219
Averaged Test Accurancy: 0.7928
Averaged Test AUC: 0.9556
Std Test Accurancy: 0.0942
Std Test AUC: 0.0226
------------------------- time cost ------------------------- 7.003406047821045

-------------Round number: 11-------------

Evaluate global model
Averaged Train Loss: 0.6914
Averaged Test Accurancy: 0.8035
Averaged Test AUC: 0.9587
Std Test Accurancy: 0.0787
Std Test AUC: 0.0176
------------------------- time cost ------------------------- 7.101449728012085

-------------Round number: 12-------------

Evaluate global model
Averaged Train Loss: 0.6601
Averaged Test Accurancy: 0.8067
Averaged Test AUC: 0.9601
Std Test Accurancy: 0.0934
Std Test AUC: 0.0203
------------------------- time cost ------------------------- 7.111158847808838

-------------Round number: 13-------------

Evaluate global model
Averaged Train Loss: 0.6385
Averaged Test Accurancy: 0.8105
Averaged Test AUC: 0.9609
Std Test Accurancy: 0.0986
Std Test AUC: 0.0217
------------------------- time cost ------------------------- 7.013674974441528

-------------Round number: 14-------------

Evaluate global model
Averaged Train Loss: 0.6147
Averaged Test Accurancy: 0.8190
Averaged Test AUC: 0.9625
Std Test Accurancy: 0.0857
Std Test AUC: 0.0192
------------------------- time cost ------------------------- 6.972790956497192

-------------Round number: 15-------------

Evaluate global model
Averaged Train Loss: 0.5926
Averaged Test Accurancy: 0.8208
Averaged Test AUC: 0.9637
Std Test Accurancy: 0.0917
Std Test AUC: 0.0198
------------------------- time cost ------------------------- 7.04244589805603

-------------Round number: 16-------------

Evaluate global model
Averaged Train Loss: 0.5756
Averaged Test Accurancy: 0.8273
Averaged Test AUC: 0.9643
Std Test Accurancy: 0.0882
Std Test AUC: 0.0203
------------------------- time cost ------------------------- 7.029688835144043

-------------Round number: 17-------------

Evaluate global model
Averaged Train Loss: 0.5532
Averaged Test Accurancy: 0.8339
Averaged Test AUC: 0.9661
Std Test Accurancy: 0.0772
Std Test AUC: 0.0176
------------------------- time cost ------------------------- 7.149883508682251

-------------Round number: 18-------------

Evaluate global model
Averaged Train Loss: 0.5388
Averaged Test Accurancy: 0.8395
Averaged Test AUC: 0.9673
Std Test Accurancy: 0.0732
Std Test AUC: 0.0162
------------------------- time cost ------------------------- 7.104814291000366

-------------Round number: 19-------------

Evaluate global model
Averaged Train Loss: 0.5236
Averaged Test Accurancy: 0.8422
Averaged Test AUC: 0.9678
Std Test Accurancy: 0.0730
Std Test AUC: 0.0170
------------------------- time cost ------------------------- 7.016967535018921

-------------Round number: 20-------------

Evaluate global model
Averaged Train Loss: 0.5080
Averaged Test Accurancy: 0.8446
Averaged Test AUC: 0.9691
Std Test Accurancy: 0.0770
Std Test AUC: 0.0162
------------------------- time cost ------------------------- 7.059299945831299

-------------Round number: 21-------------

Evaluate global model
Averaged Train Loss: 0.4990
Averaged Test Accurancy: 0.8456
Averaged Test AUC: 0.9699
Std Test Accurancy: 0.0822
Std Test AUC: 0.0166
------------------------- time cost ------------------------- 6.99688982963562

-------------Round number: 22-------------

Evaluate global model
Averaged Train Loss: 0.4848
Averaged Test Accurancy: 0.8535
Averaged Test AUC: 0.9711
Std Test Accurancy: 0.0637
Std Test AUC: 0.0134
------------------------- time cost ------------------------- 7.0764758586883545

-------------Round number: 23-------------

Evaluate global model
Averaged Train Loss: 0.4757
Averaged Test Accurancy: 0.8532
Averaged Test AUC: 0.9712
Std Test Accurancy: 0.0702
Std Test AUC: 0.0152
------------------------- time cost ------------------------- 7.11937403678894

-------------Round number: 24-------------

Evaluate global model
Averaged Train Loss: 0.4638
Averaged Test Accurancy: 0.8562
Averaged Test AUC: 0.9723
Std Test Accurancy: 0.0732
Std Test AUC: 0.0143
------------------------- time cost ------------------------- 7.043238401412964

-------------Round number: 25-------------

Evaluate global model
Averaged Train Loss: 0.4530
Averaged Test Accurancy: 0.8604
Averaged Test AUC: 0.9721
Std Test Accurancy: 0.0651
Std Test AUC: 0.0152
------------------------- time cost ------------------------- 7.062237977981567

-------------Round number: 26-------------

Evaluate global model
Averaged Train Loss: 0.4400
Averaged Test Accurancy: 0.8657
Averaged Test AUC: 0.9732
Std Test Accurancy: 0.0608
Std Test AUC: 0.0138
------------------------- time cost ------------------------- 6.872786283493042

-------------Round number: 27-------------

Evaluate global model
Averaged Train Loss: 0.4326
Averaged Test Accurancy: 0.8677
Averaged Test AUC: 0.9735
Std Test Accurancy: 0.0616
Std Test AUC: 0.0144
------------------------- time cost ------------------------- 6.979552268981934

-------------Round number: 28-------------

Evaluate global model
Averaged Train Loss: 0.4276
Averaged Test Accurancy: 0.8653
Averaged Test AUC: 0.9749
Std Test Accurancy: 0.0776
Std Test AUC: 0.0145
------------------------- time cost ------------------------- 7.132612466812134

-------------Round number: 29-------------

Evaluate global model
Averaged Train Loss: 0.4162
Averaged Test Accurancy: 0.8741
Averaged Test AUC: 0.9751
Std Test Accurancy: 0.0524
Std Test AUC: 0.0113
------------------------- time cost ------------------------- 7.107989549636841

-------------Round number: 30-------------

Evaluate global model
Averaged Train Loss: 0.4109
Averaged Test Accurancy: 0.8697
Averaged Test AUC: 0.9755
Std Test Accurancy: 0.0808
Std Test AUC: 0.0158
------------------------- time cost ------------------------- 7.0362138748168945

-------------Round number: 31-------------

Evaluate global model
Averaged Train Loss: 0.3976
Averaged Test Accurancy: 0.8782
Averaged Test AUC: 0.9762
Std Test Accurancy: 0.0560
Std Test AUC: 0.0120
------------------------- time cost ------------------------- 7.11446475982666

-------------Round number: 32-------------

Evaluate global model
Averaged Train Loss: 0.3869
Averaged Test Accurancy: 0.8813
Averaged Test AUC: 0.9767
Std Test Accurancy: 0.0555
Std Test AUC: 0.0121
------------------------- time cost ------------------------- 7.11377215385437

-------------Round number: 33-------------

Evaluate global model
Averaged Train Loss: 0.3870
Averaged Test Accurancy: 0.8798
Averaged Test AUC: 0.9768
Std Test Accurancy: 0.0654
Std Test AUC: 0.0137
------------------------- time cost ------------------------- 7.024944305419922

-------------Round number: 34-------------

Evaluate global model
Averaged Train Loss: 0.3754
Averaged Test Accurancy: 0.8843
Averaged Test AUC: 0.9776
Std Test Accurancy: 0.0518
Std Test AUC: 0.0111
------------------------- time cost ------------------------- 7.133081912994385

-------------Round number: 35-------------

Evaluate global model
Averaged Train Loss: 0.3702
Averaged Test Accurancy: 0.8875
Averaged Test AUC: 0.9772
Std Test Accurancy: 0.0470
Std Test AUC: 0.0117
------------------------- time cost ------------------------- 6.990971565246582

-------------Round number: 36-------------

Evaluate global model
Averaged Train Loss: 0.3614
Averaged Test Accurancy: 0.8890
Averaged Test AUC: 0.9783
Std Test Accurancy: 0.0551
Std Test AUC: 0.0121
------------------------- time cost ------------------------- 7.074936628341675

-------------Round number: 37-------------

Evaluate global model
Averaged Train Loss: 0.3569
Averaged Test Accurancy: 0.8904
Averaged Test AUC: 0.9787
Std Test Accurancy: 0.0523
Std Test AUC: 0.0114
------------------------- time cost ------------------------- 7.072036266326904

-------------Round number: 38-------------

Evaluate global model
Averaged Train Loss: 0.3514
Averaged Test Accurancy: 0.8934
Averaged Test AUC: 0.9791
Std Test Accurancy: 0.0479
Std Test AUC: 0.0104
------------------------- time cost ------------------------- 6.987355470657349

-------------Round number: 39-------------

Evaluate global model
Averaged Train Loss: 0.3477
Averaged Test Accurancy: 0.8922
Averaged Test AUC: 0.9790
Std Test Accurancy: 0.0642
Std Test AUC: 0.0134
------------------------- time cost ------------------------- 6.8582727909088135

-------------Round number: 40-------------

Evaluate global model
Averaged Train Loss: 0.3381
Averaged Test Accurancy: 0.8970
Averaged Test AUC: 0.9799
Std Test Accurancy: 0.0443
Std Test AUC: 0.0090
------------------------- time cost ------------------------- 6.792619228363037

-------------Round number: 41-------------

Evaluate global model
Averaged Train Loss: 0.3325
Averaged Test Accurancy: 0.8978
Averaged Test AUC: 0.9802
Std Test Accurancy: 0.0543
Std Test AUC: 0.0111
------------------------- time cost ------------------------- 6.871373653411865

-------------Round number: 42-------------

Evaluate global model
Averaged Train Loss: 0.3248
Averaged Test Accurancy: 0.9005
Averaged Test AUC: 0.9805
Std Test Accurancy: 0.0514
Std Test AUC: 0.0109
------------------------- time cost ------------------------- 7.075625658035278

-------------Round number: 43-------------

Evaluate global model
Averaged Train Loss: 0.3193
Averaged Test Accurancy: 0.9023
Averaged Test AUC: 0.9808
Std Test Accurancy: 0.0466
Std Test AUC: 0.0100
------------------------- time cost ------------------------- 6.955784320831299

-------------Round number: 44-------------

Evaluate global model
Averaged Train Loss: 0.3179
Averaged Test Accurancy: 0.9030
Averaged Test AUC: 0.9806
Std Test Accurancy: 0.0404
Std Test AUC: 0.0091
------------------------- time cost ------------------------- 6.93623161315918

-------------Round number: 45-------------

Evaluate global model
Averaged Train Loss: 0.3099
Averaged Test Accurancy: 0.9073
Averaged Test AUC: 0.9809
Std Test Accurancy: 0.0431
Std Test AUC: 0.0105
------------------------- time cost ------------------------- 7.059266805648804

-------------Round number: 46-------------

Evaluate global model
Averaged Train Loss: 0.3098
Averaged Test Accurancy: 0.9059
Averaged Test AUC: 0.9813
Std Test Accurancy: 0.0490
Std Test AUC: 0.0108
------------------------- time cost ------------------------- 7.132236957550049

-------------Round number: 47-------------

Evaluate global model
Averaged Train Loss: 0.3037
Averaged Test Accurancy: 0.9084
Averaged Test AUC: 0.9813
Std Test Accurancy: 0.0462
Std Test AUC: 0.0105
------------------------- time cost ------------------------- 7.036701440811157

-------------Round number: 48-------------

Evaluate global model
Averaged Train Loss: 0.2990
Averaged Test Accurancy: 0.9087
Averaged Test AUC: 0.9818
Std Test Accurancy: 0.0474
Std Test AUC: 0.0104
------------------------- time cost ------------------------- 6.940021753311157

-------------Round number: 49-------------

Evaluate global model
Averaged Train Loss: 0.2921
Averaged Test Accurancy: 0.9124
Averaged Test AUC: 0.9823
Std Test Accurancy: 0.0367
Std Test AUC: 0.0083
------------------------- time cost ------------------------- 6.8565287590026855

-------------Round number: 50-------------

Evaluate global model
Averaged Train Loss: 0.2914
Averaged Test Accurancy: 0.9137
Averaged Test AUC: 0.9825
Std Test Accurancy: 0.0425
Std Test AUC: 0.0094
------------------------- time cost ------------------------- 6.943233013153076

Best accuracy.
0.9137487861998058

Average time cost per round.
7.030811605453491
File path: ../results/MNIST_FedAvg_test_0.h5

Average time cost: 359.46s.
Length:  51
std for best accurancy: 0.0
mean for best accurancy: 0.9137487861998058
All done!

Storage on cuda:0
-------------------------------------------------------------------------------
Total Tensors: 36085612 	Used Memory: 93.31M
The allocated memory on cuda:0: 109.81M
Memory differs due to the matrix alignment or invisible gradient buffer tensors
-------------------------------------------------------------------------------

Total time cost: 359.53s.
